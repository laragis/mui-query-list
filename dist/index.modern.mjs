import{castArray as e,get as t,debounce as r,isEmpty as a,isString as n,isUndefined as o,flow as l,uniq as i,sortBy as s,filter as c,includes as m,last as u,has as p}from"lodash";import d,{useRef as g,useCallback as f,useEffect as y,useMemo as h,isValidElement as v,forwardRef as E,Fragment as P}from"react";import w from"prop-types";import{useQueryClient as k,useInfiniteQuery as x,useQuery as b}from"@tanstack/react-query";import{InView as L}from"react-intersection-observer";import{Pagination as T,Stack as q,TextField as N,MenuItem as C,Typography as O,Button as I,List as K,LinearProgress as z,Box as R,Alert as S,Divider as j}from"@mui/material";import F from"zustand-store-addons";import _ from"zustand/context";import B from"zustand/shallow";import M from"immer";import{useRafState as Q,useUpdateEffect as U}from"react-use";import A from"jquery";import D from"axios";import{usePagination as G}from"@mui/lab";import{scrollTo as J}from"scroll-js";import V from"numeral";const X="simple",Y="advanced",$="load-more",H="links",W="infinite-loading",Z={simple:"Simple",links:"Links",advanced:"Advanced","load-more":"Load More","infinite-loading":"Infinite Loading"};function ee(){return ee=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},ee.apply(this,arguments)}function te(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)t.indexOf(r=o[a])>=0||(n[r]=e[r]);return n}const re=()=>F((t,r)=>({pagination:"simple",queryKey:[],init:r=>{let a=[e(r.queryKey)[0],{url:r.url,pagination:r.pagination,params:ee({},e(r.queryKey)[1],{page:r.page>0?r.page:1,perPage:r.perPage>0?r.perPage:20})}];t({queryKey:a,pagination:r.pagination,selected:!1})},selected:!1,setSelected:e=>t({selected:e}),setPage:e=>t(M(t=>{t.queryKey[1].params.page=e})),setPerPage:e=>t(M(t=>{t.queryKey[1].params.perPage=e}))}),{computed:{perPage(){return t(this.queryKey,"1.params.perPage")},page(){return t(this.queryKey,"1.params.page")}}}),ae=_(),ne=ae.Provider,oe=(e,t)=>ae.useStore(...le(e,t)),le=(e,t)=>{if("string"==typeof e){if(-1!==e.indexOf(",")){const t=e.split(",").map(e=>e.trim());return[e=>t.map(t=>e[t]),B]}return[t=>t[e],t]}return[e,t]},ie=e=>{const t=k(),[r,n]=oe("queryKey, init");y(()=>{!a(r)&&t.cancelQueries(r),n(e)},[JSON.stringify(e.queryKey),e.url,e.page,e.perPage])},se=["url","params"];var ce=async({pageParam:e,queryKey:t,signal:r})=>{const a=t[1],{url:l,params:i}=a;te(a,se);const s=n(l)?{method:"get",url:l,params:i}:ee({params:ee({},i,null==l?void 0:l.params)},l);return o(e)||(s.params.page=e),(await D(ee({signal:r},s))).data};function me({meta:e}){const t=oe("setPage");/*#__PURE__*/return d.createElement(T,{variant:"outlined",showFirstButton:!0,showLastButton:!0,onChange:(e,r)=>t(r),count:null==e?void 0:e.last_page,page:null==e?void 0:e.current_page})}function ue({meta:e,sizes:t,size:r}){const[a,n,o]=oe("perPage, setPerPage, setPage"),c=null==e?void 0:e.last_page,m=null==e?void 0:e.current_page,u=e=>{let t=parseInt(e.target.value);("Enter"===e.key||"blur"===e.type)&&t>0&&t!==m&&(t<=c?o(t):alert(`Not found page ${t}`))},p=h(()=>l([i,s])(t.concat(r)),[t,r]);return console.log(p),/*#__PURE__*/d.createElement(q,{direction:"row",spacing:2,alignItems:"center",justifyContent:"center"},/*#__PURE__*/d.createElement(T,{variant:"outlined",showFirstButton:!0,showLastButton:!0,shape:"rounded",onChange:(e,t)=>o(t),count:c,page:m}),/*#__PURE__*/d.createElement(N,{select:!0,label:"Size",value:a,onChange:e=>n(parseInt(e.target.value)),size:"small",style:{width:110}},p.map((e,t)=>/*#__PURE__*/d.createElement(C,{key:t,value:e,defaultValue:!0},e," / page"))),/*#__PURE__*/d.createElement(O,null,"Go to"),/*#__PURE__*/d.createElement(N,{label:"Page",variant:"outlined",onKeyUp:u,onBlur:u,size:"small",type:"number",style:{width:85}}))}ue.defaultProps={sizes:[10,20,50,100,200]};const pe=["page","type","selected"];function de(e){const r=oe("pagination"),a="function"==typeof(n=r)&&v(n())?r:t(de.types,r,me);var n;/*#__PURE__*/return d.createElement(a,e)}de.propTypes={type:w.oneOfType([w.string,w.func])},de.types={simple:me,links:function({meta:e}){const t=oe("setPage"),{items:r}=G({count:null==e?void 0:e.last_page,onChange:(e,r)=>t(r)}),a=c(r,e=>m(["previous","next"],e.type));/*#__PURE__*/return d.createElement("nav",null,/*#__PURE__*/d.createElement(K,null,a.map((e,t)=>{let{type:r}=e,a=te(e,pe);/*#__PURE__*/return d.createElement(I,ee({type:"button"},a,{key:t}),r)})))},advanced:ue,"load-more":function({queryInfo:e}){const{isFetchingNextPage:t,fetchNextPage:r,hasNextPage:a}=e||{};return a?/*#__PURE__*/d.createElement(I,{variant:"outlined",onClick:()=>r(),disabled:!a||t},t?"Loading more...":"Load More"):"Nothing more to load"},"infinite-loading":function({queryInfo:e,threshold:t}){const{isFetchingNextPage:r,fetchNextPage:a,hasNextPage:n}=e||{};return n?r?/*#__PURE__*/d.createElement(z,{className:"w-full mt-12",color:"secondary"}):t?null:/*#__PURE__*/d.createElement(q,{alignItems:"center"},/*#__PURE__*/d.createElement(L,{as:I,onClick:()=>a(),disabled:!n||r,onChange:e=>e&&n&&a()},"Load More")):""}};const ge=E((e,r)=>{var a,n;const{renderListItem:o,renderList:l,wrapperListItem:i,onRowClicked:s}=e,[c,m,g]=oe("queryKey, selected, setSelected"),f=x(c,ce,{getPreviousPageParam:(e,t)=>{let r=e.meta.current_page-1;return r>0?r:void 0},getNextPageParam:(e,t)=>{let r=e.meta.current_page+1;return r<=e.meta.last_page?r:void 0}}),{status:y,data:v,error:E,isFetching:w,isFetchingNextPage:k,isFetchingPreviousPage:b,fetchNextPage:T,fetchPreviousPage:N,hasNextPage:C,hasPreviousPage:O}=f;ie(e);const K=h(()=>t(v,"pages.0.data.0"),[t(v,"pages.0.data.0")]),S=u((null==v?void 0:v.pages)||[]),j=h(()=>ee({},t(S,"meta")),[S]);/*#__PURE__*/return d.createElement("div",null,"loading"===y?/*#__PURE__*/d.createElement(z,{className:"w-full",color:"primary"}):"error"===y?/*#__PURE__*/d.createElement("span",null,"Error: ",E.message):/*#__PURE__*/d.createElement(P,null,e.page>1&&/*#__PURE__*/d.createElement(I,{className:"mb-6",onClick:()=>N(),disabled:!O||b},b?"Loading more...":O?"Load Older":"Nothing more to load"),/*#__PURE__*/d.createElement(l,{meta:j,firstRow:K},null==(a=v.pages)?void 0:a.map((t,r)=>/*#__PURE__*/d.createElement(P,{key:r},t.data.map((a,n)=>{let l=n+t.meta.from,c={serial:l,data:a,meta:t.meta,onRowClicked:(e,t)=>{let r=m!==l&&l;g(r),s(e,{item:t,selected:r})},selected:l===m,setSelected:g};return i?/*#__PURE__*/d.createElement(R,{key:n,component:"infinite-loading"===e.pagination&&e.threshold&&e.threshold>0&&e.threshold<=t.data.length&&t.data.length-e.threshold===n+1?L:R,onChange:(e,t)=>((e,t,r)=>{e&&C&&!p(v,["pages",r+1])&&T()})(e,0,r)},/*#__PURE__*/d.createElement(o,c)):/*#__PURE__*/d.createElement(o,ee({key:n},c))})))),e.backToTop&&(null==(n=e.scrollPosition)?void 0:n.y)>400&&/*#__PURE__*/d.createElement(I,{onClick:()=>{J(document.querySelector(e.scrollTarget)||window,{top:0,duration:200})},className:"fixed",sx:{bottom:90,right:100,zIndex:100},variant:"outlined"},/*#__PURE__*/d.createElement("i",{className:"fa-solid fa-arrow-up-to-line mr-10"}),"Back to top"),/*#__PURE__*/d.createElement(q,{direction:"row",justifyContent:"center"},/*#__PURE__*/d.createElement(de,{queryInfo:f,data:v,threshold:e.threshold})),w&&!k?/*#__PURE__*/d.createElement(q,{className:"mt-6",alignItems:"center",spacing:1},/*#__PURE__*/d.createElement("p",{className:"font-semibold"},"Background Updating..."),/*#__PURE__*/d.createElement(z,{className:"w-full",color:"primary"})):null))});ge.defaultProps={wrapperListItem:!0};var fe=ge;function ye(e){var r;const{renderListItem:a,renderList:n,onRowClicked:o}=e,[l,i,s]=oe("queryKey, selected, setSelected"),c=b(l,ce,{keepPreviousData:!0,staleTime:5e3}),{isLoading:m,isSuccess:u,isFetching:p,error:g,data:f}=c;ie(e),U(()=>{A(e.scrollTarget||window).scrollTop(0)},[f]);const y=h(()=>t(f,"data.0"),[t(f,"data.0")]);/*#__PURE__*/return d.createElement(q,{spacing:1.5},m&&/*#__PURE__*/d.createElement(z,null),(null==g?void 0:g.message)&&/*#__PURE__*/d.createElement(S,{variant:"filled",severity:"error"},null==g?void 0:g.message),u&&/*#__PURE__*/d.createElement(P,null,/*#__PURE__*/d.createElement(n,{meta:null==f?void 0:f.meta,firstRow:y},null==f||null==(r=f.data)?void 0:r.map((e,t)=>{let r=f.meta.from+t;/*#__PURE__*/return d.createElement(a,{key:t,serial:f.meta.from+t,data:e,meta:null==f?void 0:f.meta,onRowClicked:(t,a)=>{let n=i!==r&&r;s(n),o(t,{item:e,selected:n})}})})),p&&/*#__PURE__*/d.createElement(z,null)),(null==f?void 0:f.meta)&&/*#__PURE__*/d.createElement(de,{meta:f.meta,size:e.perPage,sizes:e.sizes}))}function he(e,t="0,0"){return V(e).format(t)}const ve=["children","meta"],Ee=E((e,t)=>{const a=(({scrollTarget:e,scrollIndex:t,wait:a=300})=>{const n=g(),[o,l]=Q({x:0,y:0}),i=f(t=>{let r=e?{x:"scrollLeft",y:"scrollTop"}:{x:"pageXOffset",y:"pageYOffset"};l({x:n.current[r.x],y:n.current[r.y]})},[e]);return y(()=>(n.current=e?document.querySelector(e):window,n.current.addEventListener("scroll",r(i,a)),()=>{n.current.removeEventListener("scroll",i)}),[]),y(()=>{setTimeout(()=>{scrollTo(A(e).get(0))},1e3)},[t]),o})(e),n=ee({},e,{scrollPosition:a});/*#__PURE__*/return d.createElement(ne,{createStore:re},m(["load-more","infinite-loading"],e.pagination)?/*#__PURE__*/d.createElement(fe,ee({ref:t},n)):/*#__PURE__*/d.createElement(ye,ee({ref:t},n)))});Ee.propTypes={queryKey:w.oneOfType([w.string,w.array]),url:w.oneOfType([w.string,w.object]),pagination:w.oneOfType([w.string,w.func]),page:w.oneOfType([w.string,w.number]),perPage:w.oneOfType([w.string,w.number]),select:w.func,threshold:w.number,scrollTop:w.bool,scrollTarget:w.string},Ee.defaultProps={pagination:"simple",page:1,perPage:10,renderListItem:function({serial:e,data:t}){/*#__PURE__*/return React.createElement("div",null,e,") ",t.id)},renderList:function(e){let{children:t,meta:r}=e;return te(e,ve),/*#__PURE__*/React.createElement(q,{spacing:1},/*#__PURE__*/React.createElement("div",null,"Kết quả từ ",he(r.from),"-",he(r.to)," trong số"," ",he(r.total)),/*#__PURE__*/React.createElement(q,{spacing:2,divider:/*#__PURE__*/React.createElement(j,{orientation:"horizontal"}),sx:{py:2}},t))},backToTop:!1,onRowClicked:()=>{}};var Pe=Ee;export{Y as ADVANCED,W as INFINITE_LOADING,H as LINKS,$ as LOAD_MORE,Z as PAGINATION_TYPES,Pe as QueryList,X as SIMPLE};
//# sourceMappingURL=index.modern.mjs.map
