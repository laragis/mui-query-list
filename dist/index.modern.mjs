import{get as e,debounce as t,isEmpty as a,isString as r,isUndefined as n,flow as o,uniq as l,sortBy as i,filter as s,includes as c,has as m}from"lodash";import u,{useRef as p,useCallback as g,useEffect as d,useMemo as f,isValidElement as y,Fragment as h}from"react";import v from"prop-types";import{useQueryClient as E,useInfiniteQuery as P,useQuery as x}from"@tanstack/react-query";import{InView as b}from"react-intersection-observer";import{Pagination as T,Stack as k,TextField as q,MenuItem as w,Typography as L,Button as N,List as R,LinearProgress as K,Box as O,Alert as z,Divider as I}from"@mui/material";import C from"zustand-store-addons";import F from"zustand/context";import j from"zustand/shallow";import _ from"immer";import{useRafState as B,useUpdateEffect as S}from"react-use";import M from"jquery";import U from"axios";import{usePagination as A}from"@mui/lab";import{scrollTo as D}from"scroll-js";import G from"numeral";const Q="simple",V="advanced",X="load-more",Y="links",$="infinite-loading",H={simple:"Simple",links:"Links",advanced:"Advanced","load-more":"Load More","infinite-loading":"Infinite Loading"};function J(){return J=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},J.apply(this,arguments)}function W(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)t.indexOf(a=o[r])>=0||(n[a]=e[a]);return n}const Z={pagination:"simple",queryKey:[]},ee=()=>C((e,t)=>J({},Z,{init:t=>{e({queryKey:[t.queryKey,{url:t.url,pagination:t.pagination,params:{page:t.page>0?t.page:1,perPage:t.perPage>0?t.perPage:20}}],pagination:t.pagination})},setPage:t=>e(_(e=>{e.queryKey[1].params.page=t})),setPerPage:t=>e(_(e=>{e.queryKey[1].params.perPage=t}))}),{computed:{perPage(){return e(this.queryKey,"1.params.perPage")},page(){return e(this.queryKey,"1.params.page")}}}),te=F(),ae=te.Provider,re=(e,t)=>te.useStore(...ne(e,t)),ne=(e,t)=>{if("string"==typeof e){if(-1!==e.indexOf(",")){const t=e.split(",").map(e=>e.trim());return[e=>t.map(t=>e[t]),j]}return[t=>t[e],t]}return[e,t]},oe=e=>{const t=E(),[r,n]=re("queryKey, init");d(()=>{!a(r)&&t.cancelQueries(r),n(e)},[e.queryKey,e.url,e.page,e.perPage])},le=["url","params"];var ie=async({pageParam:e,queryKey:t,signal:a})=>{const o=t[1],{url:l,params:i}=o;W(o,le);const s=r(l)?J({method:"get"},i):J({params:J({},i,null==l?void 0:l.params)},l);return n(e)||(s.params.page=e),(await U(J({signal:a},s))).data};function se({meta:e}){const t=re("setPage");/*#__PURE__*/return React.createElement(T,{variant:"outlined",showFirstButton:!0,showLastButton:!0,onChange:(e,a)=>t(a),count:null==e?void 0:e.last_page,page:null==e?void 0:e.current_page})}function ce({meta:e,sizes:t,size:a}){const[r,n,s]=re("perPage, setPerPage, setPage"),c=null==e?void 0:e.last_page,m=null==e?void 0:e.current_page,p=e=>{let t=parseInt(e.target.value);("Enter"===e.key||"blur"===e.type)&&t>0&&t!==m&&(t<=c?s(t):alert(`Not found page ${t}`))},g=f(()=>o([l,i])(t.concat(a)),[t,a]);return console.log(g),/*#__PURE__*/u.createElement(k,{direction:"row",spacing:2,alignItems:"center",justifyContent:"center"},/*#__PURE__*/u.createElement(T,{variant:"outlined",showFirstButton:!0,showLastButton:!0,shape:"rounded",onChange:(e,t)=>s(t),count:c,page:m}),/*#__PURE__*/u.createElement(q,{select:!0,label:"Size",value:r,onChange:e=>n(parseInt(e.target.value)),size:"small",style:{width:110}},g.map((e,t)=>/*#__PURE__*/u.createElement(w,{key:t,value:e,defaultValue:!0},e," / page"))),/*#__PURE__*/u.createElement(L,null,"Go to"),/*#__PURE__*/u.createElement(q,{label:"Page",variant:"outlined",onKeyUp:p,onBlur:p,size:"small",type:"number",style:{width:85}}))}ce.defaultProps={sizes:[10,20,50,100,200]};const me=["page","type","selected"];function ue(t){const a=re("pagination"),r="function"==typeof(n=a)&&y(n())?a:e(ue.types,a,se);var n;/*#__PURE__*/return u.createElement(r,t)}function pe(e){var t,a;const{renderListItem:r,renderList:n}=e,o=re("queryKey"),l=P(o,ie,{getPreviousPageParam:(e,t)=>{let a=e.meta.current_page-1;return a>0?a:void 0},getNextPageParam:(e,t)=>{let a=e.meta.current_page+1;return a<=e.meta.last_page?a:void 0}}),{status:i,data:s,error:c,isFetching:p,isFetchingNextPage:g,isFetchingPreviousPage:d,fetchNextPage:f,fetchPreviousPage:y,hasNextPage:v,hasPreviousPage:E}=l;return oe(e),/*#__PURE__*/u.createElement("div",null,"loading"===i?/*#__PURE__*/u.createElement("p",null,"Loading..."):"error"===i?/*#__PURE__*/u.createElement("span",null,"Error: ",c.message):/*#__PURE__*/u.createElement(h,null,e.page>1&&/*#__PURE__*/u.createElement(N,{className:"mb-6",onClick:()=>y(),disabled:!E||d},d?"Loading more...":E?"Load Older":"Nothing more to load"),null==(t=s.pages)?void 0:t.map((t,a)=>/*#__PURE__*/u.createElement(h,{key:a},t.data.map((o,l)=>{let i=n;return"infinite-loading"===e.pagination&&e.threshold&&e.threshold>0&&e.threshold<=t.data.length&&t.data.length-e.threshold===l+1&&(i=b),/*#__PURE__*/u.createElement(O,{key:l,component:i,onChange:(e,t)=>((e,t,a)=>{e&&v&&!m(s,["pages",a+1])&&f()})(e,0,a)},/*#__PURE__*/u.createElement(r,{serial:l+t.meta.from,data:o,meta:t.meta}))}))),e.backToTop&&(null==(a=e.scrollPosition)?void 0:a.y)>400&&/*#__PURE__*/u.createElement(N,{onClick:()=>{D(document.querySelector(e.scrollTarget)||window,{top:0,duration:200})},className:"fixed",sx:{bottom:90,right:100,zIndex:100},variant:"outlined"},/*#__PURE__*/u.createElement("i",{className:"fa-solid fa-arrow-up-to-line mr-10"}),"Back to top"),/*#__PURE__*/u.createElement(k,{direction:"row",justifyContent:"center"},/*#__PURE__*/u.createElement(ue,{queryInfo:l,data:s,threshold:e.threshold})),p&&!g?/*#__PURE__*/u.createElement(k,{className:"mt-6",alignItems:"center",spacing:1},/*#__PURE__*/u.createElement("p",{className:"font-semibold"},"Background Updating..."),/*#__PURE__*/u.createElement(K,{className:"w-full",color:"secondary"})):null))}function ge(e){var t;const{renderListItem:a,renderList:r}=e,n=re("queryKey"),o=x(n,ie,{keepPreviousData:!0,staleTime:5e3}),{isLoading:l,isSuccess:i,isFetching:s,error:c,data:m}=o;return oe(e),S(()=>{M(e.scrollTarget||window).scrollTop(0)},[m]),/*#__PURE__*/React.createElement(k,{spacing:1.5},l&&/*#__PURE__*/React.createElement(K,null),(null==c?void 0:c.message)&&/*#__PURE__*/React.createElement(z,{variant:"filled",severity:"error"},null==c?void 0:c.message),i&&/*#__PURE__*/React.createElement(Fragment,null,/*#__PURE__*/React.createElement(r,{meta:null==m?void 0:m.meta},null==m||null==(t=m.data)?void 0:t.map((e,t)=>/*#__PURE__*/React.createElement(a,{key:t,serial:m.meta.from+t,data:e,meta:null==m?void 0:m.meta}))),s&&/*#__PURE__*/React.createElement(K,null)),(null==m?void 0:m.meta)&&/*#__PURE__*/React.createElement(ue,{meta:m.meta,size:e.perPage,sizes:e.sizes}))}function de(e,t="0,0"){return G(e).format(t)}ue.propTypes={type:v.oneOfType([v.string,v.func])},ue.types={simple:se,links:function({meta:e}){const t=re("setPage"),{items:a}=A({count:null==e?void 0:e.last_page,onChange:(e,a)=>t(a)}),r=s(a,e=>c(["previous","next"],e.type));/*#__PURE__*/return React.createElement("nav",null,/*#__PURE__*/React.createElement(R,null,r.map((e,t)=>{let{type:a}=e,r=W(e,me);/*#__PURE__*/return React.createElement(N,J({type:"button"},r,{key:t}),a)})))},advanced:ce,"load-more":function({queryInfo:e}){const{isFetchingNextPage:t,fetchNextPage:a,hasNextPage:r}=e||{};return r?/*#__PURE__*/React.createElement(N,{variant:"outlined",onClick:()=>a(),disabled:!r||t},t?"Loading more...":"Load More"):"Nothing more to load"},"infinite-loading":function({queryInfo:e,threshold:t}){const{isFetchingNextPage:a,fetchNextPage:r,hasNextPage:n}=e||{};return n?a?/*#__PURE__*/u.createElement(K,{className:"w-full mt-12",color:"secondary"}):t?null:/*#__PURE__*/u.createElement(k,{alignItems:"center"},/*#__PURE__*/u.createElement(b,{as:N,onClick:()=>r(),disabled:!n||a,onChange:e=>e&&n&&r()},"Load More")):"Nothing more to load"}};const fe=["children","meta"];function ye(e){const a=(({scrollTarget:e,scrollIndex:a,wait:r=300})=>{const n=p(),[o,l]=B({x:0,y:0}),i=g(t=>{let a=e?{x:"scrollLeft",y:"scrollTop"}:{x:"pageXOffset",y:"pageYOffset"};l({x:n.current[a.x],y:n.current[a.y]})},[e]);return d(()=>(n.current=e?document.querySelector(e):window,n.current.addEventListener("scroll",t(i,r)),()=>{n.current.removeEventListener("scroll",i)}),[]),d(()=>{setTimeout(()=>{console.log(e),scrollTo(M(e).get(0))},1e3)},[a]),o})(e);/*#__PURE__*/return u.createElement(ae,{createStore:ee},c(["load-more","infinite-loading"],e.pagination)?/*#__PURE__*/u.createElement(pe,J({},e,{scrollPosition:a})):/*#__PURE__*/u.createElement(ge,J({},e,{scrollPosition:a})))}ye.propTypes={queryKey:v.string,url:v.oneOfType([v.string,v.object]),pagination:v.oneOfType([v.string,v.func]),page:v.oneOfType([v.string,v.number]),perPage:v.oneOfType([v.string,v.number]),select:v.func,threshold:v.number,scrollTop:v.bool,scrollTarget:v.string},ye.defaultProps={pagination:"simple",page:1,perPage:10,renderListItem:function({serial:e,data:t}){/*#__PURE__*/return React.createElement("div",null,e,") ",t.id)},renderList:function(e){let{children:t,meta:a}=e;return W(e,fe),/*#__PURE__*/React.createElement(k,{spacing:1},/*#__PURE__*/React.createElement("div",null,"Kết quả từ ",de(a.from),"-",de(a.to)," trong số"," ",de(a.total)),/*#__PURE__*/React.createElement(k,{spacing:2,divider:/*#__PURE__*/React.createElement(I,{orientation:"horizontal"}),sx:{py:2}},t))},backToTop:!1};export{V as ADVANCED,$ as INFINITE_LOADING,Y as LINKS,X as LOAD_MORE,H as PAGINATION_TYPES,ye as QueryList,Q as SIMPLE};
//# sourceMappingURL=index.modern.mjs.map
