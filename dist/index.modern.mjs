import{get as e,debounce as t,isEmpty as a,isString as r,isUndefined as n,flow as o,uniq as l,sortBy as i,filter as s,includes as c,has as m}from"lodash";import u,{useRef as p,useCallback as d,useEffect as g,useMemo as f,isValidElement as y,forwardRef as h,Fragment as v}from"react";import E from"prop-types";import{useQueryClient as P,useInfiniteQuery as w,useQuery as k}from"@tanstack/react-query";import{InView as x}from"react-intersection-observer";import{Pagination as b,Stack as L,TextField as N,MenuItem as T,Typography as q,Button as C,List as I,LinearProgress as K,Box as O,Alert as z,Divider as R}from"@mui/material";import S from"zustand-store-addons";import j from"zustand/context";import F from"zustand/shallow";import _ from"immer";import{useRafState as B,useDeepCompareEffect as M,useUpdateEffect as Q}from"react-use";import U from"jquery";import A from"axios";import{usePagination as D}from"@mui/lab";import{scrollTo as G}from"scroll-js";import V from"numeral";const X="simple",Y="advanced",$="load-more",H="links",J="infinite-loading",W={simple:"Simple",links:"Links",advanced:"Advanced","load-more":"Load More","infinite-loading":"Infinite Loading"};function Z(){return Z=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},Z.apply(this,arguments)}function ee(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)t.indexOf(a=o[r])>=0||(n[a]=e[a]);return n}const te=()=>S((e,t)=>({pagination:"simple",queryKey:[],init:t=>{e({queryKey:[t.queryKey,{url:t.url,pagination:t.pagination,params:{page:t.page>0?t.page:1,perPage:t.perPage>0?t.perPage:20}}],pagination:t.pagination,selected:!1})},selected:!1,setSelected:t=>e({selected:t}),setPage:t=>e(_(e=>{e.queryKey[1].params.page=t})),setPerPage:t=>e(_(e=>{e.queryKey[1].params.perPage=t}))}),{computed:{perPage(){return e(this.queryKey,"1.params.perPage")},page(){return e(this.queryKey,"1.params.page")}}}),ae=j(),re=ae.Provider,ne=(e,t)=>ae.useStore(...oe(e,t)),oe=(e,t)=>{if("string"==typeof e){if(-1!==e.indexOf(",")){const t=e.split(",").map(e=>e.trim());return[e=>t.map(t=>e[t]),F]}return[t=>t[e],t]}return[e,t]},le=e=>{const t=P(),[r,n]=ne("queryKey, init");M(()=>{!a(r)&&t.cancelQueries(r),n(e)},[e.queryKey,e.url,e.page,e.perPage])},ie=["url","params"];var se=async({pageParam:e,queryKey:t,signal:a})=>{const o=t[1],{url:l,params:i}=o;ee(o,ie);const s=r(l)?Z({method:"get"},i):Z({params:Z({},i,null==l?void 0:l.params)},l);return n(e)||(s.params.page=e),(await A(Z({signal:a},s))).data};function ce({meta:e}){const t=ne("setPage");/*#__PURE__*/return u.createElement(b,{variant:"outlined",showFirstButton:!0,showLastButton:!0,onChange:(e,a)=>t(a),count:null==e?void 0:e.last_page,page:null==e?void 0:e.current_page})}function me({meta:e,sizes:t,size:a}){const[r,n,s]=ne("perPage, setPerPage, setPage"),c=null==e?void 0:e.last_page,m=null==e?void 0:e.current_page,p=e=>{let t=parseInt(e.target.value);("Enter"===e.key||"blur"===e.type)&&t>0&&t!==m&&(t<=c?s(t):alert(`Not found page ${t}`))},d=f(()=>o([l,i])(t.concat(a)),[t,a]);return console.log(d),/*#__PURE__*/u.createElement(L,{direction:"row",spacing:2,alignItems:"center",justifyContent:"center"},/*#__PURE__*/u.createElement(b,{variant:"outlined",showFirstButton:!0,showLastButton:!0,shape:"rounded",onChange:(e,t)=>s(t),count:c,page:m}),/*#__PURE__*/u.createElement(N,{select:!0,label:"Size",value:r,onChange:e=>n(parseInt(e.target.value)),size:"small",style:{width:110}},d.map((e,t)=>/*#__PURE__*/u.createElement(T,{key:t,value:e,defaultValue:!0},e," / page"))),/*#__PURE__*/u.createElement(q,null,"Go to"),/*#__PURE__*/u.createElement(N,{label:"Page",variant:"outlined",onKeyUp:p,onBlur:p,size:"small",type:"number",style:{width:85}}))}me.defaultProps={sizes:[10,20,50,100,200]};const ue=["page","type","selected"];function pe(t){const a=ne("pagination"),r="function"==typeof(n=a)&&y(n())?a:e(pe.types,a,ce);var n;/*#__PURE__*/return u.createElement(r,t)}pe.propTypes={type:E.oneOfType([E.string,E.func])},pe.types={simple:ce,links:function({meta:e}){const t=ne("setPage"),{items:a}=D({count:null==e?void 0:e.last_page,onChange:(e,a)=>t(a)}),r=s(a,e=>c(["previous","next"],e.type));/*#__PURE__*/return u.createElement("nav",null,/*#__PURE__*/u.createElement(I,null,r.map((e,t)=>{let{type:a}=e,r=ee(e,ue);/*#__PURE__*/return u.createElement(C,Z({type:"button"},r,{key:t}),a)})))},advanced:me,"load-more":function({queryInfo:e}){const{isFetchingNextPage:t,fetchNextPage:a,hasNextPage:r}=e||{};return r?/*#__PURE__*/u.createElement(C,{variant:"outlined",onClick:()=>a(),disabled:!r||t},t?"Loading more...":"Load More"):"Nothing more to load"},"infinite-loading":function({queryInfo:e,threshold:t}){const{isFetchingNextPage:a,fetchNextPage:r,hasNextPage:n}=e||{};return n?a?/*#__PURE__*/u.createElement(K,{className:"w-full mt-12",color:"secondary"}):t?null:/*#__PURE__*/u.createElement(L,{alignItems:"center"},/*#__PURE__*/u.createElement(x,{as:C,onClick:()=>r(),disabled:!n||a,onChange:e=>e&&n&&r()},"Load More")):"Nothing more to load"}};const de=h((t,a)=>{var r,n;const{renderListItem:o,renderList:l,wrapperListItem:i,onRowClicked:s}=t,[c,p,d]=ne("queryKey, selected, setSelected"),y=w(c,se,{getPreviousPageParam:(e,t)=>{let a=e.meta.current_page-1;return a>0?a:void 0},getNextPageParam:(e,t)=>{let a=e.meta.current_page+1;return a<=e.meta.last_page?a:void 0}}),{status:h,data:E,error:P,isFetching:k,isFetchingNextPage:b,isFetchingPreviousPage:N,fetchNextPage:T,fetchPreviousPage:q,hasNextPage:I,hasPreviousPage:z}=y;le(t);const R=f(()=>e(E,"pages.0.data.0"),[e(E,"pages.0.data.0")]);return g(()=>{console.log(a)},[]),/*#__PURE__*/u.createElement("div",null,"loading"===h?/*#__PURE__*/u.createElement(K,{className:"w-full",color:"primary"}):"error"===h?/*#__PURE__*/u.createElement("span",null,"Error: ",P.message):/*#__PURE__*/u.createElement(v,null,t.page>1&&/*#__PURE__*/u.createElement(C,{className:"mb-6",onClick:()=>q(),disabled:!z||N},N?"Loading more...":z?"Load Older":"Nothing more to load"),/*#__PURE__*/u.createElement(l,{meta:null==E?void 0:E.meta,firstRow:R,aaa:123},null==(r=E.pages)?void 0:r.map((e,a)=>/*#__PURE__*/u.createElement(v,{key:a},e.data.map((r,n)=>{let l=n+e.meta.from,c={serial:l,data:r,meta:e.meta,onRowClicked:(e,t)=>{let a=p!==l&&l;d(a),s(e,{item:t,selected:a})},selected:l===p,setSelected:d};return i?/*#__PURE__*/u.createElement(O,{key:n,component:"infinite-loading"===t.pagination&&t.threshold&&t.threshold>0&&t.threshold<=e.data.length&&e.data.length-t.threshold===n+1?x:O,onChange:(e,t)=>((e,t,a)=>{e&&I&&!m(E,["pages",a+1])&&T()})(e,0,a)},/*#__PURE__*/u.createElement(o,c)):/*#__PURE__*/u.createElement(o,Z({key:n},c))})))),t.backToTop&&(null==(n=t.scrollPosition)?void 0:n.y)>400&&/*#__PURE__*/u.createElement(C,{onClick:()=>{G(document.querySelector(t.scrollTarget)||window,{top:0,duration:200})},className:"fixed",sx:{bottom:90,right:100,zIndex:100},variant:"outlined"},/*#__PURE__*/u.createElement("i",{className:"fa-solid fa-arrow-up-to-line mr-10"}),"Back to top"),/*#__PURE__*/u.createElement(L,{direction:"row",justifyContent:"center"},/*#__PURE__*/u.createElement(pe,{queryInfo:y,data:E,threshold:t.threshold})),k&&!b?/*#__PURE__*/u.createElement(L,{className:"mt-6",alignItems:"center",spacing:1},/*#__PURE__*/u.createElement("p",{className:"font-semibold"},"Background Updating..."),/*#__PURE__*/u.createElement(K,{className:"w-full",color:"primary"})):null))});de.defaultProps={wrapperListItem:!0};var ge=de;function fe(t){var a;const{renderListItem:r,renderList:n,onRowClicked:o}=t,[l,i,s]=ne("queryKey, selected, setSelected"),c=k(l,se,{keepPreviousData:!0,staleTime:5e3}),{isLoading:m,isSuccess:p,isFetching:d,error:g,data:y}=c;le(t),Q(()=>{U(t.scrollTarget||window).scrollTop(0)},[y]);const h=f(()=>e(y,"data.0"),[e(y,"data.0")]);/*#__PURE__*/return u.createElement(L,{spacing:1.5},m&&/*#__PURE__*/u.createElement(K,null),(null==g?void 0:g.message)&&/*#__PURE__*/u.createElement(z,{variant:"filled",severity:"error"},null==g?void 0:g.message),p&&/*#__PURE__*/u.createElement(v,null,/*#__PURE__*/u.createElement(n,{meta:null==y?void 0:y.meta,firstRow:h},null==y||null==(a=y.data)?void 0:a.map((e,t)=>{let a=y.meta.from+t;/*#__PURE__*/return u.createElement(r,{key:t,serial:y.meta.from+t,data:e,meta:null==y?void 0:y.meta,onRowClicked:(t,r)=>{let n=i!==a&&a;s(n),o(t,{item:e,selected:n})}})})),d&&/*#__PURE__*/u.createElement(K,null)),(null==y?void 0:y.meta)&&/*#__PURE__*/u.createElement(pe,{meta:y.meta,size:t.perPage,sizes:t.sizes}))}function ye(e,t="0,0"){return V(e).format(t)}const he=["children","meta"],ve=h((e,a)=>{const r=(({scrollTarget:e,scrollIndex:a,wait:r=300})=>{const n=p(),[o,l]=B({x:0,y:0}),i=d(t=>{let a=e?{x:"scrollLeft",y:"scrollTop"}:{x:"pageXOffset",y:"pageYOffset"};l({x:n.current[a.x],y:n.current[a.y]})},[e]);return g(()=>(n.current=e?document.querySelector(e):window,n.current.addEventListener("scroll",t(i,r)),()=>{n.current.removeEventListener("scroll",i)}),[]),g(()=>{setTimeout(()=>{scrollTo(U(e).get(0))},1e3)},[a]),o})(e),n=Z({},e,{scrollPosition:r});/*#__PURE__*/return u.createElement(re,{createStore:te},c(["load-more","infinite-loading"],e.pagination)?/*#__PURE__*/u.createElement(ge,Z({ref:a},n)):/*#__PURE__*/u.createElement(fe,Z({ref:a},n)))});ve.propTypes={queryKey:E.string,url:E.oneOfType([E.string,E.object]),pagination:E.oneOfType([E.string,E.func]),page:E.oneOfType([E.string,E.number]),perPage:E.oneOfType([E.string,E.number]),select:E.func,threshold:E.number,scrollTop:E.bool,scrollTarget:E.string},ve.defaultProps={pagination:"simple",page:1,perPage:10,renderListItem:function({serial:e,data:t}){/*#__PURE__*/return React.createElement("div",null,e,") ",t.id)},renderList:function(e){let{children:t,meta:a}=e;return ee(e,he),/*#__PURE__*/React.createElement(L,{spacing:1},/*#__PURE__*/React.createElement("div",null,"Kết quả từ ",ye(a.from),"-",ye(a.to)," trong số"," ",ye(a.total)),/*#__PURE__*/React.createElement(L,{spacing:2,divider:/*#__PURE__*/React.createElement(R,{orientation:"horizontal"}),sx:{py:2}},t))},backToTop:!1,onRowClicked:()=>{}};var Ee=ve;export{Y as ADVANCED,J as INFINITE_LOADING,H as LINKS,$ as LOAD_MORE,W as PAGINATION_TYPES,Ee as QueryList,X as SIMPLE};
//# sourceMappingURL=index.modern.mjs.map
