import{get as e,debounce as t,isEmpty as r,isString as a,isUndefined as n,flow as o,uniq as l,sortBy as i,filter as s,includes as c,has as m}from"lodash";import u,{useRef as p,useCallback as g,useEffect as d,useMemo as f,isValidElement as y,Fragment as h}from"react";import v from"prop-types";import{useQueryClient as E,useInfiniteQuery as P,useQuery as x}from"@tanstack/react-query";import{InView as b}from"react-intersection-observer";import{Pagination as T,Stack as k,TextField as q,MenuItem as w,Typography as L,Button as N,List as K,LinearProgress as O,Box as z,Alert as I,Divider as C}from"@mui/material";import j from"zustand-store-addons";import F from"zustand/context";import _ from"zustand/shallow";import B from"immer";import{useRafState as S,useUpdateEffect as R}from"react-use";import M from"jquery";import U from"axios";import{usePagination as A}from"@mui/lab";import{scrollTo as D}from"scroll-js";import G from"numeral";const Q="simple",V="advanced",X="load-more",Y="links",$="infinite-loading",H={simple:"Simple",links:"Links",advanced:"Advanced","load-more":"Load More","infinite-loading":"Infinite Loading"};function J(){return J=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},J.apply(this,arguments)}function W(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)t.indexOf(r=o[a])>=0||(n[r]=e[r]);return n}const Z={pagination:"simple",queryKey:[]},ee=()=>j((e,t)=>J({},Z,{init:t=>{e({queryKey:[t.queryKey,{url:t.url,pagination:t.pagination,params:{page:t.page>0?t.page:1,perPage:t.perPage>0?t.perPage:20}}],pagination:t.pagination})},setPage:t=>e(B(e=>{e.queryKey[1].params.page=t})),setPerPage:t=>e(B(e=>{e.queryKey[1].params.perPage=t}))}),{computed:{perPage(){return e(this.queryKey,"1.params.perPage")},page(){return e(this.queryKey,"1.params.page")}}}),te=F(),re=te.Provider,ae=(e,t)=>te.useStore(...ne(e,t)),ne=(e,t)=>{if("string"==typeof e){if(-1!==e.indexOf(",")){const t=e.split(",").map(e=>e.trim());return[e=>t.map(t=>e[t]),_]}return[t=>t[e],t]}return[e,t]},oe=e=>{const t=E(),[a,n]=ae("queryKey, init");d(()=>{!r(a)&&t.cancelQueries(a),n(e)},[e.queryKey,e.url,e.page,e.perPage])},le=["url","params"];var ie=async({pageParam:e,queryKey:t,signal:r})=>{const o=t[1],{url:l,params:i}=o;W(o,le);const s=a(l)?J({method:"get"},i):J({params:J({},i,null==l?void 0:l.params)},l);return n(e)||(s.params.page=e),(await U(J({signal:r},s))).data};function se({meta:e}){const t=ae("setPage");/*#__PURE__*/return u.createElement(T,{variant:"outlined",showFirstButton:!0,showLastButton:!0,onChange:(e,r)=>t(r),count:null==e?void 0:e.last_page,page:null==e?void 0:e.current_page})}function ce({meta:e,sizes:t,size:r}){const[a,n,s]=ae("perPage, setPerPage, setPage"),c=null==e?void 0:e.last_page,m=null==e?void 0:e.current_page,p=e=>{let t=parseInt(e.target.value);("Enter"===e.key||"blur"===e.type)&&t>0&&t!==m&&(t<=c?s(t):alert(`Not found page ${t}`))},g=f(()=>o([l,i])(t.concat(r)),[t,r]);return console.log(g),/*#__PURE__*/u.createElement(k,{direction:"row",spacing:2,alignItems:"center",justifyContent:"center"},/*#__PURE__*/u.createElement(T,{variant:"outlined",showFirstButton:!0,showLastButton:!0,shape:"rounded",onChange:(e,t)=>s(t),count:c,page:m}),/*#__PURE__*/u.createElement(q,{select:!0,label:"Size",value:a,onChange:e=>n(parseInt(e.target.value)),size:"small",style:{width:110}},g.map((e,t)=>/*#__PURE__*/u.createElement(w,{key:t,value:e,defaultValue:!0},e," / page"))),/*#__PURE__*/u.createElement(L,null,"Go to"),/*#__PURE__*/u.createElement(q,{label:"Page",variant:"outlined",onKeyUp:p,onBlur:p,size:"small",type:"number",style:{width:85}}))}ce.defaultProps={sizes:[10,20,50,100,200]};const me=["page","type","selected"];function ue(t){const r=ae("pagination"),a="function"==typeof(n=r)&&y(n())?r:e(ue.types,r,se);var n;/*#__PURE__*/return u.createElement(a,t)}function pe(e){var t,r;const{renderListItem:a,renderList:n}=e,o=ae("queryKey"),l=P(o,ie,{getPreviousPageParam:(e,t)=>{let r=e.meta.current_page-1;return r>0?r:void 0},getNextPageParam:(e,t)=>{let r=e.meta.current_page+1;return r<=e.meta.last_page?r:void 0}}),{status:i,data:s,error:c,isFetching:p,isFetchingNextPage:g,isFetchingPreviousPage:d,fetchNextPage:f,fetchPreviousPage:y,hasNextPage:v,hasPreviousPage:E}=l;return oe(e),/*#__PURE__*/u.createElement("div",null,"loading"===i?/*#__PURE__*/u.createElement("p",null,"Loading..."):"error"===i?/*#__PURE__*/u.createElement("span",null,"Error: ",c.message):/*#__PURE__*/u.createElement(h,null,e.page>1&&/*#__PURE__*/u.createElement(N,{className:"mb-6",onClick:()=>y(),disabled:!E||d},d?"Loading more...":E?"Load Older":"Nothing more to load"),null==(t=s.pages)?void 0:t.map((t,r)=>/*#__PURE__*/u.createElement(h,{key:r},t.data.map((o,l)=>{let i=n;return"infinite-loading"===e.pagination&&e.threshold&&e.threshold>0&&e.threshold<=t.data.length&&t.data.length-e.threshold===l+1&&(i=b),/*#__PURE__*/u.createElement(z,{key:l,component:i,onChange:(e,t)=>((e,t,r)=>{e&&v&&!m(s,["pages",r+1])&&f()})(e,0,r)},/*#__PURE__*/u.createElement(a,{serial:l+t.meta.from,data:o,meta:t.meta}))}))),e.backToTop&&(null==(r=e.scrollPosition)?void 0:r.y)>400&&/*#__PURE__*/u.createElement(N,{onClick:()=>{D(document.querySelector(e.scrollTarget)||window,{top:0,duration:200})},className:"fixed",sx:{bottom:90,right:100,zIndex:100},variant:"outlined"},/*#__PURE__*/u.createElement("i",{className:"fa-solid fa-arrow-up-to-line mr-10"}),"Back to top"),/*#__PURE__*/u.createElement(k,{direction:"row",justifyContent:"center"},/*#__PURE__*/u.createElement(ue,{queryInfo:l,data:s,threshold:e.threshold})),p&&!g?/*#__PURE__*/u.createElement(k,{className:"mt-6",alignItems:"center",spacing:1},/*#__PURE__*/u.createElement("p",{className:"font-semibold"},"Background Updating..."),/*#__PURE__*/u.createElement(O,{className:"w-full",color:"secondary"})):null))}function ge(e){var t;const{renderListItem:r,renderList:a}=e,n=ae("queryKey"),o=x(n,ie,{keepPreviousData:!0,staleTime:5e3}),{isLoading:l,isSuccess:i,isFetching:s,error:c,data:m}=o;return oe(e),R(()=>{M(e.scrollTarget||window).scrollTop(0)},[m]),/*#__PURE__*/u.createElement(k,{spacing:1.5},l&&/*#__PURE__*/u.createElement(O,null),(null==c?void 0:c.message)&&/*#__PURE__*/u.createElement(I,{variant:"filled",severity:"error"},null==c?void 0:c.message),i&&/*#__PURE__*/u.createElement(h,null,/*#__PURE__*/u.createElement(a,{meta:null==m?void 0:m.meta},null==m||null==(t=m.data)?void 0:t.map((e,t)=>/*#__PURE__*/u.createElement(r,{key:t,serial:m.meta.from+t,data:e,meta:null==m?void 0:m.meta}))),s&&/*#__PURE__*/u.createElement(O,null)),(null==m?void 0:m.meta)&&/*#__PURE__*/u.createElement(ue,{meta:m.meta,size:e.perPage,sizes:e.sizes}))}function de(e,t="0,0"){return G(e).format(t)}ue.propTypes={type:v.oneOfType([v.string,v.func])},ue.types={simple:se,links:function({meta:e}){const t=ae("setPage"),{items:r}=A({count:null==e?void 0:e.last_page,onChange:(e,r)=>t(r)}),a=s(r,e=>c(["previous","next"],e.type));/*#__PURE__*/return u.createElement("nav",null,/*#__PURE__*/u.createElement(K,null,a.map((e,t)=>{let{type:r}=e,a=W(e,me);/*#__PURE__*/return u.createElement(N,J({type:"button"},a,{key:t}),r)})))},advanced:ce,"load-more":function({queryInfo:e}){const{isFetchingNextPage:t,fetchNextPage:r,hasNextPage:a}=e||{};return a?/*#__PURE__*/u.createElement(N,{variant:"outlined",onClick:()=>r(),disabled:!a||t},t?"Loading more...":"Load More"):"Nothing more to load"},"infinite-loading":function({queryInfo:e,threshold:t}){const{isFetchingNextPage:r,fetchNextPage:a,hasNextPage:n}=e||{};return n?r?/*#__PURE__*/u.createElement(O,{className:"w-full mt-12",color:"secondary"}):t?null:/*#__PURE__*/u.createElement(k,{alignItems:"center"},/*#__PURE__*/u.createElement(b,{as:N,onClick:()=>a(),disabled:!n||r,onChange:e=>e&&n&&a()},"Load More")):"Nothing more to load"}};const fe=["children","meta"];function ye(e){const r=(({scrollTarget:e,scrollIndex:r,wait:a=300})=>{const n=p(),[o,l]=S({x:0,y:0}),i=g(t=>{let r=e?{x:"scrollLeft",y:"scrollTop"}:{x:"pageXOffset",y:"pageYOffset"};l({x:n.current[r.x],y:n.current[r.y]})},[e]);return d(()=>(n.current=e?document.querySelector(e):window,n.current.addEventListener("scroll",t(i,a)),()=>{n.current.removeEventListener("scroll",i)}),[]),d(()=>{setTimeout(()=>{console.log(e),scrollTo(M(e).get(0))},1e3)},[r]),o})(e);/*#__PURE__*/return u.createElement(re,{createStore:ee},c(["load-more","infinite-loading"],e.pagination)?/*#__PURE__*/u.createElement(pe,J({},e,{scrollPosition:r})):/*#__PURE__*/u.createElement(ge,J({},e,{scrollPosition:r})))}ye.propTypes={queryKey:v.string,url:v.oneOfType([v.string,v.object]),pagination:v.oneOfType([v.string,v.func]),page:v.oneOfType([v.string,v.number]),perPage:v.oneOfType([v.string,v.number]),select:v.func,threshold:v.number,scrollTop:v.bool,scrollTarget:v.string},ye.defaultProps={pagination:"simple",page:1,perPage:10,renderListItem:function({serial:e,data:t}){/*#__PURE__*/return React.createElement("div",null,e,") ",t.id)},renderList:function(e){let{children:t,meta:r}=e;return W(e,fe),/*#__PURE__*/React.createElement(k,{spacing:1},/*#__PURE__*/React.createElement("div",null,"Kết quả từ ",de(r.from),"-",de(r.to)," trong số"," ",de(r.total)),/*#__PURE__*/React.createElement(k,{spacing:2,divider:/*#__PURE__*/React.createElement(C,{orientation:"horizontal"}),sx:{py:2}},t))},backToTop:!1};export{V as ADVANCED,$ as INFINITE_LOADING,Y as LINKS,X as LOAD_MORE,H as PAGINATION_TYPES,ye as QueryList,Q as SIMPLE};
//# sourceMappingURL=index.modern.mjs.map
