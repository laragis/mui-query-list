var e=require("lodash"),t=require("react"),n=require("prop-types"),a=require("@tanstack/react-query"),r=require("react-intersection-observer"),l=require("@mui/material"),u=require("zustand-store-addons"),i=require("zustand/context"),o=require("zustand/shallow"),c=require("immer"),s=require("react-use"),d=require("jquery"),f=require("axios"),m=require("@mui/lab"),g=require("scroll-js"),p=require("numeral");function y(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var v,h=/*#__PURE__*/y(t),E=/*#__PURE__*/y(n),P=/*#__PURE__*/y(u),q=/*#__PURE__*/y(i),x=/*#__PURE__*/y(o),L=/*#__PURE__*/y(c),k=/*#__PURE__*/y(d),b=/*#__PURE__*/y(f),N=/*#__PURE__*/y(p),T=((v={}).simple="Simple",v.links="Links",v.advanced="Advanced",v["load-more"]="Load More",v["infinite-loading"]="Infinite Loading",v);function I(){return I=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},I.apply(this,arguments)}function w(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)t.indexOf(n=l[a])>=0||(r[n]=e[n]);return r}var R={pagination:"simple",queryKey:[]},O=function(){return P.default(function(e,t){return I({},R,{init:function(t){e({queryKey:[t.queryKey,{url:t.url,pagination:t.pagination,params:{page:t.page>0?t.page:1,perPage:t.perPage>0?t.perPage:20}}],pagination:t.pagination})},setPage:function(t){return e(L.default(function(e){e.queryKey[1].params.page=t}))},setPerPage:function(t){return e(L.default(function(e){e.queryKey[1].params.perPage=t}))}})},{computed:{perPage:function(){return e.get(this.queryKey,"1.params.perPage")},page:function(){return e.get(this.queryKey,"1.params.page")}}})},S=q.default(),K=S.Provider,C=function(e,t){return S.useStore.apply(S,z(e,t))},z=function(e,t){if("string"==typeof e){if(-1!==e.indexOf(",")){var n=e.split(",").map(function(e){return e.trim()});return[function(e){return n.map(function(t){return e[t]})},x.default]}return[function(t){return t[e]},t]}return[e,t]},B=function(n){var r=a.useQueryClient(),l=C("queryKey, init"),u=l[0],i=l[1];t.useEffect(function(){!e.isEmpty(u)&&r.cancelQueries(u),i(n)},[n.queryKey,n.url,n.page,n.perPage])},F=["url","params"],j=function(t){var n=t.pageParam,a=t.queryKey,r=t.signal;try{var l=a[1],u=l.url,i=l.params,o=(w(l,F),e.isString(u)?I({method:"get"},i):I({params:I({},i,null==u?void 0:u.params)},u));return e.isUndefined(n)||(o.params.page=n),Promise.resolve(b.default(I({signal:r},o))).then(function(e){return e.data})}catch(e){return Promise.reject(e)}};function _(e){var t=e.meta,n=C("setPage");/*#__PURE__*/return React.createElement(l.Pagination,{variant:"outlined",showFirstButton:!0,showLastButton:!0,onChange:function(e,t){return n(t)},count:null==t?void 0:t.last_page,page:null==t?void 0:t.current_page})}function A(n){var a=n.meta,r=n.sizes,u=n.size,i=C("perPage, setPerPage, setPage"),o=i[0],c=i[1],s=i[2],d=null==a?void 0:a.last_page,f=null==a?void 0:a.current_page,m=function(e){var t=parseInt(e.target.value);("Enter"===e.key||"blur"===e.type)&&t>0&&t!==f&&(t<=d?s(t):alert("Not found page "+t))},g=t.useMemo(function(){return e.flow([e.uniq,e.sortBy])(r.concat(u))},[r,u]);return console.log(g),/*#__PURE__*/h.default.createElement(l.Stack,{direction:"row",spacing:2,alignItems:"center",justifyContent:"center"},/*#__PURE__*/h.default.createElement(l.Pagination,{variant:"outlined",showFirstButton:!0,showLastButton:!0,shape:"rounded",onChange:function(e,t){return s(t)},count:d,page:f}),/*#__PURE__*/h.default.createElement(l.TextField,{select:!0,label:"Size",value:o,onChange:function(e){return c(parseInt(e.target.value))},size:"small",style:{width:110}},g.map(function(e,t){/*#__PURE__*/return h.default.createElement(l.MenuItem,{key:t,value:e,defaultValue:!0},e," / page")})),/*#__PURE__*/h.default.createElement(l.Typography,null,"Go to"),/*#__PURE__*/h.default.createElement(l.TextField,{label:"Page",variant:"outlined",onKeyUp:m,onBlur:m,size:"small",type:"number",style:{width:85}}))}A.defaultProps={sizes:[10,20,50,100,200]};var M,D=["page","type","selected"];function Q(n){var a,r=C("pagination"),l="function"==typeof(a=r)&&t.isValidElement(a())?r:e.get(Q.types,r,_);/*#__PURE__*/return h.default.createElement(l,n)}function V(n){var u,i,o=n.renderListItem,c=n.renderList,s=C("queryKey"),d=a.useInfiniteQuery(s,j,{getPreviousPageParam:function(e,t){var n=e.meta.current_page-1;return n>0?n:void 0},getNextPageParam:function(e,t){var n=e.meta.current_page+1;return n<=e.meta.last_page?n:void 0}}),f=d.status,m=d.data,p=d.error,y=d.isFetching,v=d.isFetchingNextPage,E=d.isFetchingPreviousPage,P=d.fetchNextPage,q=d.fetchPreviousPage,x=d.hasNextPage,L=d.hasPreviousPage;return B(n),/*#__PURE__*/h.default.createElement("div",null,"loading"===f?/*#__PURE__*/h.default.createElement("p",null,"Loading..."):"error"===f?/*#__PURE__*/h.default.createElement("span",null,"Error: ",p.message):/*#__PURE__*/h.default.createElement(t.Fragment,null,n.page>1&&/*#__PURE__*/h.default.createElement(l.Button,{className:"mb-6",onClick:function(){return q()},disabled:!L||E},E?"Loading more...":L?"Load Older":"Nothing more to load"),null==(u=m.pages)?void 0:u.map(function(a,u){/*#__PURE__*/return h.default.createElement(t.Fragment,{key:u},a.data.map(function(t,i){var s=c;return"infinite-loading"===n.pagination&&n.threshold&&n.threshold>0&&n.threshold<=a.data.length&&a.data.length-n.threshold===i+1&&(s=r.InView),/*#__PURE__*/h.default.createElement(l.Box,{key:i,component:s,onChange:function(t,n){return function(t,n,a){t&&x&&!e.has(m,["pages",a+1])&&P()}(t,0,u)}},/*#__PURE__*/h.default.createElement(o,{serial:i+a.meta.from,data:t,meta:a.meta}))}))}),n.backToTop&&(null==(i=n.scrollPosition)?void 0:i.y)>400&&/*#__PURE__*/h.default.createElement(l.Button,{onClick:function(){g.scrollTo(document.querySelector(n.scrollTarget)||window,{top:0,duration:200})},className:"fixed",sx:{bottom:90,right:100,zIndex:100},variant:"outlined"},/*#__PURE__*/h.default.createElement("i",{className:"fa-solid fa-arrow-up-to-line mr-10"}),"Back to top"),/*#__PURE__*/h.default.createElement(l.Stack,{direction:"row",justifyContent:"center"},/*#__PURE__*/h.default.createElement(Q,{queryInfo:d,data:m,threshold:n.threshold})),y&&!v?/*#__PURE__*/h.default.createElement(l.Stack,{className:"mt-6",alignItems:"center",spacing:1},/*#__PURE__*/h.default.createElement("p",{className:"font-semibold"},"Background Updating..."),/*#__PURE__*/h.default.createElement(l.LinearProgress,{className:"w-full",color:"secondary"})):null))}function U(e){var t,n=e.renderListItem,r=e.renderList,u=C("queryKey"),i=a.useQuery(u,j,{keepPreviousData:!0,staleTime:5e3}),o=i.isLoading,c=i.isSuccess,d=i.isFetching,f=i.error,m=i.data;return B(e),s.useUpdateEffect(function(){k.default(e.scrollTarget||window).scrollTop(0)},[m]),/*#__PURE__*/React.createElement(l.Stack,{spacing:1.5},o&&/*#__PURE__*/React.createElement(l.LinearProgress,null),(null==f?void 0:f.message)&&/*#__PURE__*/React.createElement(l.Alert,{variant:"filled",severity:"error"},null==f?void 0:f.message),c&&/*#__PURE__*/React.createElement(Fragment,null,/*#__PURE__*/React.createElement(r,{meta:null==m?void 0:m.meta},null==m||null==(t=m.data)?void 0:t.map(function(e,t){/*#__PURE__*/return React.createElement(n,{key:t,serial:m.meta.from+t,data:e,meta:null==m?void 0:m.meta})})),d&&/*#__PURE__*/React.createElement(l.LinearProgress,null)),(null==m?void 0:m.meta)&&/*#__PURE__*/React.createElement(Q,{meta:m.meta,size:e.perPage,sizes:e.sizes}))}function G(e,t){return void 0===t&&(t="0,0"),N.default(e).format(t)}Q.propTypes={type:E.default.oneOfType([E.default.string,E.default.func])},Q.types=((M={}).simple=_,M.links=function(t){var n=t.meta,a=C("setPage"),r=m.usePagination({count:null==n?void 0:n.last_page,onChange:function(e,t){return a(t)}}),u=e.filter(r.items,function(t){return e.includes(["previous","next"],t.type)});/*#__PURE__*/return React.createElement("nav",null,/*#__PURE__*/React.createElement(l.List,null,u.map(function(e,t){var n=e.type,a=w(e,D);/*#__PURE__*/return React.createElement(l.Button,I({type:"button"},a,{key:t}),n)})))},M.advanced=A,M["load-more"]=function(e){var t=e.queryInfo||{},n=t.isFetchingNextPage,a=t.fetchNextPage,r=t.hasNextPage;return r?/*#__PURE__*/React.createElement(l.Button,{variant:"outlined",onClick:function(){return a()},disabled:!r||n},n?"Loading more...":"Load More"):"Nothing more to load"},M["infinite-loading"]=function(e){var t=e.threshold,n=e.queryInfo||{},a=n.isFetchingNextPage,u=n.fetchNextPage,i=n.hasNextPage;return i?a?/*#__PURE__*/h.default.createElement(l.LinearProgress,{className:"w-full mt-12",color:"secondary"}):t?null:/*#__PURE__*/h.default.createElement(l.Stack,{alignItems:"center"},/*#__PURE__*/h.default.createElement(r.InView,{as:l.Button,onClick:function(){return u()},disabled:!i||a,onChange:function(e){return e&&i&&u()}},"Load More")):"Nothing more to load"},M);var Y=["children","meta"];function X(n){var a,r,l,u,i,o,c,d,f,m,g=(r=(a=n).scrollTarget,l=a.scrollIndex,i=void 0===(u=a.wait)?300:u,o=t.useRef(),d=(c=s.useRafState({x:0,y:0}))[0],f=c[1],m=t.useCallback(function(e){var t=r?{x:"scrollLeft",y:"scrollTop"}:{x:"pageXOffset",y:"pageYOffset"};f({x:o.current[t.x],y:o.current[t.y]})},[r]),t.useEffect(function(){return o.current=r?document.querySelector(r):window,o.current.addEventListener("scroll",e.debounce(m,i)),function(){o.current.removeEventListener("scroll",m)}},[]),t.useEffect(function(){setTimeout(function(){console.log(r),scrollTo(k.default(r).get(0))},1e3)},[l]),d);/*#__PURE__*/return h.default.createElement(K,{createStore:O},e.includes(["load-more","infinite-loading"],n.pagination)?/*#__PURE__*/h.default.createElement(V,I({},n,{scrollPosition:g})):/*#__PURE__*/h.default.createElement(U,I({},n,{scrollPosition:g})))}X.propTypes={queryKey:E.default.string,url:E.default.oneOfType([E.default.string,E.default.object]),pagination:E.default.oneOfType([E.default.string,E.default.func]),page:E.default.oneOfType([E.default.string,E.default.number]),perPage:E.default.oneOfType([E.default.string,E.default.number]),select:E.default.func,threshold:E.default.number,scrollTop:E.default.bool,scrollTarget:E.default.string},X.defaultProps={pagination:"simple",page:1,perPage:10,renderListItem:function(e){/*#__PURE__*/return React.createElement("div",null,e.serial,") ",e.data.id)},renderList:function(e){var t=e.children,n=e.meta;return w(e,Y),/*#__PURE__*/React.createElement(l.Stack,{spacing:1},/*#__PURE__*/React.createElement("div",null,"Kết quả từ ",G(n.from),"-",G(n.to)," trong số"," ",G(n.total)),/*#__PURE__*/React.createElement(l.Stack,{spacing:2,divider:/*#__PURE__*/React.createElement(l.Divider,{orientation:"horizontal"}),sx:{py:2}},t))},backToTop:!1},exports.ADVANCED="advanced",exports.INFINITE_LOADING="infinite-loading",exports.LINKS="links",exports.LOAD_MORE="load-more",exports.PAGINATION_TYPES=T,exports.QueryList=X,exports.SIMPLE="simple";
//# sourceMappingURL=index.js.map
