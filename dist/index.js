var e=require("lodash"),t=require("react"),a=require("prop-types"),n=require("@tanstack/react-query"),r=require("react-intersection-observer"),l=require("@mui/material"),u=require("zustand-store-addons"),i=require("zustand/context"),o=require("zustand/shallow"),s=require("immer"),c=require("react-use"),d=require("jquery"),f=require("axios"),m=require("@mui/lab"),g=require("scroll-js"),p=require("numeral");function y(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var v,h=/*#__PURE__*/y(t),E=/*#__PURE__*/y(a),P=/*#__PURE__*/y(u),q=/*#__PURE__*/y(i),x=/*#__PURE__*/y(o),k=/*#__PURE__*/y(s),w=/*#__PURE__*/y(d),L=/*#__PURE__*/y(f),N=/*#__PURE__*/y(p),T=((v={}).simple="Simple",v.links="Links",v.advanced="Advanced",v["load-more"]="Load More",v["infinite-loading"]="Infinite Loading",v);function b(){return b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},b.apply(this,arguments)}function I(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)t.indexOf(a=l[n])>=0||(r[a]=e[a]);return r}var S=function(){return P.default(function(e,t){return{pagination:"simple",queryKey:[],init:function(t){e({queryKey:[t.queryKey,{url:t.url,pagination:t.pagination,params:{page:t.page>0?t.page:1,perPage:t.perPage>0?t.perPage:20}}],pagination:t.pagination,selected:!1})},selected:!1,setSelected:function(t){return e({selected:t})},setPage:function(t){return e(k.default(function(e){e.queryKey[1].params.page=t}))},setPerPage:function(t){return e(k.default(function(e){e.queryKey[1].params.perPage=t}))}}},{computed:{perPage:function(){return e.get(this.queryKey,"1.params.perPage")},page:function(){return e.get(this.queryKey,"1.params.page")}}})},O=q.default(),C=O.Provider,R=function(e,t){return O.useStore.apply(O,K(e,t))},K=function(e,t){if("string"==typeof e){if(-1!==e.indexOf(",")){var a=e.split(",").map(function(e){return e.trim()});return[function(e){return a.map(function(t){return e[t]})},x.default]}return[function(t){return t[e]},t]}return[e,t]},B=function(a){var r=n.useQueryClient(),l=R("queryKey, init"),u=l[0],i=l[1];t.useEffect(function(){!e.isEmpty(u)&&r.cancelQueries(u),i(a)},[JSON.stringify(a.queryKey),a.url,a.page,a.perPage])},z=["url","params"],F=function(t){var a=t.pageParam,n=t.queryKey,r=t.signal;try{var l=n[1],u=l.url,i=l.params,o=(I(l,z),e.isString(u)?b({method:"get",url:u},i):b({params:b({},i,null==u?void 0:u.params)},u));return e.isUndefined(a)||(o.params.page=a),Promise.resolve(L.default(b({signal:r},o))).then(function(e){return e.data})}catch(e){return Promise.reject(e)}};function j(e){var t=e.meta,a=R("setPage");/*#__PURE__*/return h.default.createElement(l.Pagination,{variant:"outlined",showFirstButton:!0,showLastButton:!0,onChange:function(e,t){return a(t)},count:null==t?void 0:t.last_page,page:null==t?void 0:t.current_page})}function _(a){var n=a.meta,r=a.sizes,u=a.size,i=R("perPage, setPerPage, setPage"),o=i[0],s=i[1],c=i[2],d=null==n?void 0:n.last_page,f=null==n?void 0:n.current_page,m=function(e){var t=parseInt(e.target.value);("Enter"===e.key||"blur"===e.type)&&t>0&&t!==f&&(t<=d?c(t):alert("Not found page "+t))},g=t.useMemo(function(){return e.flow([e.uniq,e.sortBy])(r.concat(u))},[r,u]);return console.log(g),/*#__PURE__*/h.default.createElement(l.Stack,{direction:"row",spacing:2,alignItems:"center",justifyContent:"center"},/*#__PURE__*/h.default.createElement(l.Pagination,{variant:"outlined",showFirstButton:!0,showLastButton:!0,shape:"rounded",onChange:function(e,t){return c(t)},count:d,page:f}),/*#__PURE__*/h.default.createElement(l.TextField,{select:!0,label:"Size",value:o,onChange:function(e){return s(parseInt(e.target.value))},size:"small",style:{width:110}},g.map(function(e,t){/*#__PURE__*/return h.default.createElement(l.MenuItem,{key:t,value:e,defaultValue:!0},e," / page")})),/*#__PURE__*/h.default.createElement(l.Typography,null,"Go to"),/*#__PURE__*/h.default.createElement(l.TextField,{label:"Page",variant:"outlined",onKeyUp:m,onBlur:m,size:"small",type:"number",style:{width:85}}))}_.defaultProps={sizes:[10,20,50,100,200]};var M,A=["page","type","selected"];function D(a){var n,r=R("pagination"),l="function"==typeof(n=r)&&t.isValidElement(n())?r:e.get(D.types,r,j);/*#__PURE__*/return h.default.createElement(l,a)}D.propTypes={type:E.default.oneOfType([E.default.string,E.default.func])},D.types=((M={}).simple=j,M.links=function(t){var a=t.meta,n=R("setPage"),r=m.usePagination({count:null==a?void 0:a.last_page,onChange:function(e,t){return n(t)}}),u=e.filter(r.items,function(t){return e.includes(["previous","next"],t.type)});/*#__PURE__*/return h.default.createElement("nav",null,/*#__PURE__*/h.default.createElement(l.List,null,u.map(function(e,t){var a=e.type,n=I(e,A);/*#__PURE__*/return h.default.createElement(l.Button,b({type:"button"},n,{key:t}),a)})))},M.advanced=_,M["load-more"]=function(e){var t=e.queryInfo||{},a=t.isFetchingNextPage,n=t.fetchNextPage,r=t.hasNextPage;return r?/*#__PURE__*/h.default.createElement(l.Button,{variant:"outlined",onClick:function(){return n()},disabled:!r||a},a?"Loading more...":"Load More"):"Nothing more to load"},M["infinite-loading"]=function(e){var t=e.threshold,a=e.queryInfo||{},n=a.isFetchingNextPage,u=a.fetchNextPage,i=a.hasNextPage;return i?n?/*#__PURE__*/h.default.createElement(l.LinearProgress,{className:"w-full mt-12",color:"secondary"}):t?null:/*#__PURE__*/h.default.createElement(l.Stack,{alignItems:"center"},/*#__PURE__*/h.default.createElement(r.InView,{as:l.Button,onClick:function(){return u()},disabled:!i||n,onChange:function(e){return e&&i&&u()}},"Load More")):"Nothing more to load"},M);var Q=t.forwardRef(function(a,u){var i,o,s=a.renderListItem,c=a.renderList,d=a.wrapperListItem,f=a.onRowClicked,m=R("queryKey, selected, setSelected"),p=m[1],y=m[2],v=n.useInfiniteQuery(m[0],F,{getPreviousPageParam:function(e,t){var a=e.meta.current_page-1;return a>0?a:void 0},getNextPageParam:function(e,t){var a=e.meta.current_page+1;return a<=e.meta.last_page?a:void 0}}),E=v.status,P=v.data,q=v.error,x=v.isFetching,k=v.isFetchingNextPage,w=v.isFetchingPreviousPage,L=v.fetchNextPage,N=v.fetchPreviousPage,T=v.hasNextPage,I=v.hasPreviousPage;B(a);var S=t.useMemo(function(){return e.get(P,"pages.0.data.0")},[e.get(P,"pages.0.data.0")]);return t.useEffect(function(){},[]),/*#__PURE__*/h.default.createElement("div",null,"loading"===E?/*#__PURE__*/h.default.createElement(l.LinearProgress,{className:"w-full",color:"primary"}):"error"===E?/*#__PURE__*/h.default.createElement("span",null,"Error: ",q.message):/*#__PURE__*/h.default.createElement(t.Fragment,null,a.page>1&&/*#__PURE__*/h.default.createElement(l.Button,{className:"mb-6",onClick:function(){return N()},disabled:!I||w},w?"Loading more...":I?"Load Older":"Nothing more to load"),/*#__PURE__*/h.default.createElement(c,{meta:null==P?void 0:P.meta,firstRow:S,aaa:123},null==(i=P.pages)?void 0:i.map(function(n,u){/*#__PURE__*/return h.default.createElement(t.Fragment,{key:u},n.data.map(function(t,i){var o=i+n.meta.from,c={serial:o,data:t,meta:n.meta,onRowClicked:function(e,t){var a=p!==o&&o;y(a),f(e,{item:t,selected:a})},selected:o===p,setSelected:y};return d?/*#__PURE__*/h.default.createElement(l.Box,{key:i,component:"infinite-loading"===a.pagination&&a.threshold&&a.threshold>0&&a.threshold<=n.data.length&&n.data.length-a.threshold===i+1?r.InView:l.Box,onChange:function(t,a){return function(t,a,n){t&&T&&!e.has(P,["pages",n+1])&&L()}(t,0,u)}},/*#__PURE__*/h.default.createElement(s,c)):/*#__PURE__*/h.default.createElement(s,b({key:i},c))}))})),a.backToTop&&(null==(o=a.scrollPosition)?void 0:o.y)>400&&/*#__PURE__*/h.default.createElement(l.Button,{onClick:function(){g.scrollTo(document.querySelector(a.scrollTarget)||window,{top:0,duration:200})},className:"fixed",sx:{bottom:90,right:100,zIndex:100},variant:"outlined"},/*#__PURE__*/h.default.createElement("i",{className:"fa-solid fa-arrow-up-to-line mr-10"}),"Back to top"),/*#__PURE__*/h.default.createElement(l.Stack,{direction:"row",justifyContent:"center"},/*#__PURE__*/h.default.createElement(D,{queryInfo:v,data:P,threshold:a.threshold})),x&&!k?/*#__PURE__*/h.default.createElement(l.Stack,{className:"mt-6",alignItems:"center",spacing:1},/*#__PURE__*/h.default.createElement("p",{className:"font-semibold"},"Background Updating..."),/*#__PURE__*/h.default.createElement(l.LinearProgress,{className:"w-full",color:"primary"})):null))});Q.defaultProps={wrapperListItem:!0};var V=Q;function U(a){var r,u=a.renderListItem,i=a.renderList,o=a.onRowClicked,s=R("queryKey, selected, setSelected"),d=s[1],f=s[2],m=n.useQuery(s[0],F,{keepPreviousData:!0,staleTime:5e3}),g=m.isLoading,p=m.isSuccess,y=m.isFetching,v=m.error,E=m.data;B(a),c.useUpdateEffect(function(){w.default(a.scrollTarget||window).scrollTop(0)},[E]);var P=t.useMemo(function(){return e.get(E,"data.0")},[e.get(E,"data.0")]);/*#__PURE__*/return h.default.createElement(l.Stack,{spacing:1.5},g&&/*#__PURE__*/h.default.createElement(l.LinearProgress,null),(null==v?void 0:v.message)&&/*#__PURE__*/h.default.createElement(l.Alert,{variant:"filled",severity:"error"},null==v?void 0:v.message),p&&/*#__PURE__*/h.default.createElement(t.Fragment,null,/*#__PURE__*/h.default.createElement(i,{meta:null==E?void 0:E.meta,firstRow:P},null==E||null==(r=E.data)?void 0:r.map(function(e,t){var a=E.meta.from+t;/*#__PURE__*/return h.default.createElement(u,{key:t,serial:E.meta.from+t,data:e,meta:null==E?void 0:E.meta,onRowClicked:function(t,n){var r=d!==a&&a;f(r),o(t,{item:e,selected:r})}})})),y&&/*#__PURE__*/h.default.createElement(l.LinearProgress,null)),(null==E?void 0:E.meta)&&/*#__PURE__*/h.default.createElement(D,{meta:E.meta,size:a.perPage,sizes:a.sizes}))}function G(e,t){return void 0===t&&(t="0,0"),N.default(e).format(t)}var Y=["children","meta"],J=t.forwardRef(function(a,n){var r=function(a){var n=a.scrollTarget,r=a.scrollIndex,l=a.wait,u=void 0===l?300:l,i=t.useRef(),o=c.useRafState({x:0,y:0}),s=o[0],d=o[1],f=t.useCallback(function(e){var t=n?{x:"scrollLeft",y:"scrollTop"}:{x:"pageXOffset",y:"pageYOffset"};d({x:i.current[t.x],y:i.current[t.y]})},[n]);return t.useEffect(function(){return i.current=n?document.querySelector(n):window,i.current.addEventListener("scroll",e.debounce(f,u)),function(){i.current.removeEventListener("scroll",f)}},[]),t.useEffect(function(){setTimeout(function(){scrollTo(w.default(n).get(0))},1e3)},[r]),s}(a),l=b({},a,{scrollPosition:r});/*#__PURE__*/return h.default.createElement(C,{createStore:S},e.includes(["load-more","infinite-loading"],a.pagination)?/*#__PURE__*/h.default.createElement(V,b({ref:n},l)):/*#__PURE__*/h.default.createElement(U,b({ref:n},l)))});J.propTypes={queryKey:E.default.oneOfType([E.default.string,E.default.array]),url:E.default.oneOfType([E.default.string,E.default.object]),pagination:E.default.oneOfType([E.default.string,E.default.func]),page:E.default.oneOfType([E.default.string,E.default.number]),perPage:E.default.oneOfType([E.default.string,E.default.number]),select:E.default.func,threshold:E.default.number,scrollTop:E.default.bool,scrollTarget:E.default.string},J.defaultProps={pagination:"simple",page:1,perPage:10,renderListItem:function(e){/*#__PURE__*/return React.createElement("div",null,e.serial,") ",e.data.id)},renderList:function(e){var t=e.children,a=e.meta;return I(e,Y),/*#__PURE__*/React.createElement(l.Stack,{spacing:1},/*#__PURE__*/React.createElement("div",null,"Kết quả từ ",G(a.from),"-",G(a.to)," trong số"," ",G(a.total)),/*#__PURE__*/React.createElement(l.Stack,{spacing:2,divider:/*#__PURE__*/React.createElement(l.Divider,{orientation:"horizontal"}),sx:{py:2}},t))},backToTop:!1,onRowClicked:function(){}};var X=J;exports.ADVANCED="advanced",exports.INFINITE_LOADING="infinite-loading",exports.LINKS="links",exports.LOAD_MORE="load-more",exports.PAGINATION_TYPES=T,exports.QueryList=X,exports.SIMPLE="simple";
//# sourceMappingURL=index.js.map
