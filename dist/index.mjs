import{get as e,debounce as t,isEmpty as n,isString as r,isUndefined as a,flow as o,uniq as i,sortBy as l,filter as u,includes as c,has as s}from"lodash";import m,{useRef as p,useCallback as d,useEffect as f,useMemo as g,isValidElement as v,forwardRef as y,Fragment as h}from"react";import E from"prop-types";import{useQueryClient as P,useInfiniteQuery as w,useQuery as k}from"@tanstack/react-query";import{InView as x}from"react-intersection-observer";import{Pagination as b,Stack as L,TextField as N,MenuItem as T,Typography as q,Button as C,List as I,LinearProgress as K,Box as O,Alert as z,Divider as R}from"@mui/material";import S from"zustand-store-addons";import j from"zustand/context";import F from"zustand/shallow";import _ from"immer";import{useRafState as B,useDeepCompareEffect as M,useUpdateEffect as Q}from"react-use";import U from"jquery";import A from"axios";import{usePagination as D}from"@mui/lab";import{scrollTo as G}from"scroll-js";import V from"numeral";var X,Y="simple",H="advanced",J="load-more",W="links",Z="infinite-loading",$=((X={}).simple="Simple",X.links="Links",X.advanced="Advanced",X["load-more"]="Load More",X["infinite-loading"]="Infinite Loading",X);function ee(){return ee=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ee.apply(this,arguments)}function te(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t.indexOf(n=o[r])>=0||(a[n]=e[n]);return a}var ne=function(){return S(function(e,t){return{pagination:"simple",queryKey:[],init:function(t){e({queryKey:[t.queryKey,{url:t.url,pagination:t.pagination,params:{page:t.page>0?t.page:1,perPage:t.perPage>0?t.perPage:20}}],pagination:t.pagination,selected:!1})},selected:!1,setSelected:function(t){return e({selected:t})},setPage:function(t){return e(_(function(e){e.queryKey[1].params.page=t}))},setPerPage:function(t){return e(_(function(e){e.queryKey[1].params.perPage=t}))}}},{computed:{perPage:function(){return e(this.queryKey,"1.params.perPage")},page:function(){return e(this.queryKey,"1.params.page")}}})},re=j(),ae=re.Provider,oe=function(e,t){return re.useStore.apply(re,ie(e,t))},ie=function(e,t){if("string"==typeof e){if(-1!==e.indexOf(",")){var n=e.split(",").map(function(e){return e.trim()});return[function(e){return n.map(function(t){return e[t]})},F]}return[function(t){return t[e]},t]}return[e,t]},le=function(e){var t=P(),r=oe("queryKey, init"),a=r[0],o=r[1];M(function(){!n(a)&&t.cancelQueries(a),o(e)},[e.queryKey,e.url,e.page,e.perPage])},ue=["url","params"],ce=function(e){var t=e.pageParam,n=e.queryKey,o=e.signal;try{var i=n[1],l=i.url,u=i.params,c=(te(i,ue),r(l)?ee({method:"get"},u):ee({params:ee({},u,null==l?void 0:l.params)},l));return a(t)||(c.params.page=t),Promise.resolve(A(ee({signal:o},c))).then(function(e){return e.data})}catch(e){return Promise.reject(e)}};function se(e){var t=e.meta,n=oe("setPage");/*#__PURE__*/return m.createElement(b,{variant:"outlined",showFirstButton:!0,showLastButton:!0,onChange:function(e,t){return n(t)},count:null==t?void 0:t.last_page,page:null==t?void 0:t.current_page})}function me(e){var t=e.meta,n=e.sizes,r=e.size,a=oe("perPage, setPerPage, setPage"),u=a[0],c=a[1],s=a[2],p=null==t?void 0:t.last_page,d=null==t?void 0:t.current_page,f=function(e){var t=parseInt(e.target.value);("Enter"===e.key||"blur"===e.type)&&t>0&&t!==d&&(t<=p?s(t):alert("Not found page "+t))},v=g(function(){return o([i,l])(n.concat(r))},[n,r]);return console.log(v),/*#__PURE__*/m.createElement(L,{direction:"row",spacing:2,alignItems:"center",justifyContent:"center"},/*#__PURE__*/m.createElement(b,{variant:"outlined",showFirstButton:!0,showLastButton:!0,shape:"rounded",onChange:function(e,t){return s(t)},count:p,page:d}),/*#__PURE__*/m.createElement(N,{select:!0,label:"Size",value:u,onChange:function(e){return c(parseInt(e.target.value))},size:"small",style:{width:110}},v.map(function(e,t){/*#__PURE__*/return m.createElement(T,{key:t,value:e,defaultValue:!0},e," / page")})),/*#__PURE__*/m.createElement(q,null,"Go to"),/*#__PURE__*/m.createElement(N,{label:"Page",variant:"outlined",onKeyUp:f,onBlur:f,size:"small",type:"number",style:{width:85}}))}me.defaultProps={sizes:[10,20,50,100,200]};var pe,de=["page","type","selected"];function fe(t){var n,r=oe("pagination"),a="function"==typeof(n=r)&&v(n())?r:e(fe.types,r,se);/*#__PURE__*/return m.createElement(a,t)}fe.propTypes={type:E.oneOfType([E.string,E.func])},fe.types=((pe={}).simple=se,pe.links=function(e){var t=e.meta,n=oe("setPage"),r=D({count:null==t?void 0:t.last_page,onChange:function(e,t){return n(t)}}),a=u(r.items,function(e){return c(["previous","next"],e.type)});/*#__PURE__*/return m.createElement("nav",null,/*#__PURE__*/m.createElement(I,null,a.map(function(e,t){var n=e.type,r=te(e,de);/*#__PURE__*/return m.createElement(C,ee({type:"button"},r,{key:t}),n)})))},pe.advanced=me,pe["load-more"]=function(e){var t=e.queryInfo||{},n=t.isFetchingNextPage,r=t.fetchNextPage,a=t.hasNextPage;return a?/*#__PURE__*/m.createElement(C,{variant:"outlined",onClick:function(){return r()},disabled:!a||n},n?"Loading more...":"Load More"):"Nothing more to load"},pe["infinite-loading"]=function(e){var t=e.threshold,n=e.queryInfo||{},r=n.isFetchingNextPage,a=n.fetchNextPage,o=n.hasNextPage;return o?r?/*#__PURE__*/m.createElement(K,{className:"w-full mt-12",color:"secondary"}):t?null:/*#__PURE__*/m.createElement(L,{alignItems:"center"},/*#__PURE__*/m.createElement(x,{as:C,onClick:function(){return a()},disabled:!o||r,onChange:function(e){return e&&o&&a()}},"Load More")):"Nothing more to load"},pe);var ge=y(function(t,n){var r,a,o=t.renderListItem,i=t.renderList,l=t.wrapperListItem,u=t.onRowClicked,c=oe("queryKey, selected, setSelected"),p=c[1],d=c[2],v=w(c[0],ce,{getPreviousPageParam:function(e,t){var n=e.meta.current_page-1;return n>0?n:void 0},getNextPageParam:function(e,t){var n=e.meta.current_page+1;return n<=e.meta.last_page?n:void 0}}),y=v.status,E=v.data,P=v.error,k=v.isFetching,b=v.isFetchingNextPage,N=v.isFetchingPreviousPage,T=v.fetchNextPage,q=v.fetchPreviousPage,I=v.hasNextPage,z=v.hasPreviousPage;le(t);var R=g(function(){return e(E,"pages.0.data.0")},[e(E,"pages.0.data.0")]);return f(function(){},[]),/*#__PURE__*/m.createElement("div",null,"loading"===y?/*#__PURE__*/m.createElement(K,{className:"w-full",color:"primary"}):"error"===y?/*#__PURE__*/m.createElement("span",null,"Error: ",P.message):/*#__PURE__*/m.createElement(h,null,t.page>1&&/*#__PURE__*/m.createElement(C,{className:"mb-6",onClick:function(){return q()},disabled:!z||N},N?"Loading more...":z?"Load Older":"Nothing more to load"),/*#__PURE__*/m.createElement(i,{meta:null==E?void 0:E.meta,firstRow:R,aaa:123},null==(r=E.pages)?void 0:r.map(function(e,n){/*#__PURE__*/return m.createElement(h,{key:n},e.data.map(function(r,a){var i=a+e.meta.from,c={serial:i,data:r,meta:e.meta,onRowClicked:function(e,t){var n=p!==i&&i;d(n),u(e,{item:t,selected:n})},selected:i===p,setSelected:d};return l?/*#__PURE__*/m.createElement(O,{key:a,component:"infinite-loading"===t.pagination&&t.threshold&&t.threshold>0&&t.threshold<=e.data.length&&e.data.length-t.threshold===a+1?x:O,onChange:function(e,t){return function(e,t,n){e&&I&&!s(E,["pages",n+1])&&T()}(e,0,n)}},/*#__PURE__*/m.createElement(o,c)):/*#__PURE__*/m.createElement(o,ee({key:a},c))}))})),t.backToTop&&(null==(a=t.scrollPosition)?void 0:a.y)>400&&/*#__PURE__*/m.createElement(C,{onClick:function(){G(document.querySelector(t.scrollTarget)||window,{top:0,duration:200})},className:"fixed",sx:{bottom:90,right:100,zIndex:100},variant:"outlined"},/*#__PURE__*/m.createElement("i",{className:"fa-solid fa-arrow-up-to-line mr-10"}),"Back to top"),/*#__PURE__*/m.createElement(L,{direction:"row",justifyContent:"center"},/*#__PURE__*/m.createElement(fe,{queryInfo:v,data:E,threshold:t.threshold})),k&&!b?/*#__PURE__*/m.createElement(L,{className:"mt-6",alignItems:"center",spacing:1},/*#__PURE__*/m.createElement("p",{className:"font-semibold"},"Background Updating..."),/*#__PURE__*/m.createElement(K,{className:"w-full",color:"primary"})):null))});ge.defaultProps={wrapperListItem:!0};var ve=ge;function ye(t){var n,r=t.renderListItem,a=t.renderList,o=t.onRowClicked,i=oe("queryKey, selected, setSelected"),l=i[1],u=i[2],c=k(i[0],ce,{keepPreviousData:!0,staleTime:5e3}),s=c.isLoading,p=c.isSuccess,d=c.isFetching,f=c.error,v=c.data;le(t),Q(function(){U(t.scrollTarget||window).scrollTop(0)},[v]);var y=g(function(){return e(v,"data.0")},[e(v,"data.0")]);/*#__PURE__*/return m.createElement(L,{spacing:1.5},s&&/*#__PURE__*/m.createElement(K,null),(null==f?void 0:f.message)&&/*#__PURE__*/m.createElement(z,{variant:"filled",severity:"error"},null==f?void 0:f.message),p&&/*#__PURE__*/m.createElement(h,null,/*#__PURE__*/m.createElement(a,{meta:null==v?void 0:v.meta,firstRow:y},null==v||null==(n=v.data)?void 0:n.map(function(e,t){var n=v.meta.from+t;/*#__PURE__*/return m.createElement(r,{key:t,serial:v.meta.from+t,data:e,meta:null==v?void 0:v.meta,onRowClicked:function(t,r){var a=l!==n&&n;u(a),o(t,{item:e,selected:a})}})})),d&&/*#__PURE__*/m.createElement(K,null)),(null==v?void 0:v.meta)&&/*#__PURE__*/m.createElement(fe,{meta:v.meta,size:t.perPage,sizes:t.sizes}))}function he(e,t){return void 0===t&&(t="0,0"),V(e).format(t)}var Ee=["children","meta"],Pe=y(function(e,n){var r=function(e){var n=e.scrollTarget,r=e.scrollIndex,a=e.wait,o=void 0===a?300:a,i=p(),l=B({x:0,y:0}),u=l[0],c=l[1],s=d(function(e){var t=n?{x:"scrollLeft",y:"scrollTop"}:{x:"pageXOffset",y:"pageYOffset"};c({x:i.current[t.x],y:i.current[t.y]})},[n]);return f(function(){return i.current=n?document.querySelector(n):window,i.current.addEventListener("scroll",t(s,o)),function(){i.current.removeEventListener("scroll",s)}},[]),f(function(){setTimeout(function(){scrollTo(U(n).get(0))},1e3)},[r]),u}(e),a=ee({},e,{scrollPosition:r});/*#__PURE__*/return m.createElement(ae,{createStore:ne},c(["load-more","infinite-loading"],e.pagination)?/*#__PURE__*/m.createElement(ve,ee({ref:n},a)):/*#__PURE__*/m.createElement(ye,ee({ref:n},a)))});Pe.propTypes={queryKey:E.string,url:E.oneOfType([E.string,E.object]),pagination:E.oneOfType([E.string,E.func]),page:E.oneOfType([E.string,E.number]),perPage:E.oneOfType([E.string,E.number]),select:E.func,threshold:E.number,scrollTop:E.bool,scrollTarget:E.string},Pe.defaultProps={pagination:"simple",page:1,perPage:10,renderListItem:function(e){/*#__PURE__*/return React.createElement("div",null,e.serial,") ",e.data.id)},renderList:function(e){var t=e.children,n=e.meta;return te(e,Ee),/*#__PURE__*/React.createElement(L,{spacing:1},/*#__PURE__*/React.createElement("div",null,"Kết quả từ ",he(n.from),"-",he(n.to)," trong số"," ",he(n.total)),/*#__PURE__*/React.createElement(L,{spacing:2,divider:/*#__PURE__*/React.createElement(R,{orientation:"horizontal"}),sx:{py:2}},t))},backToTop:!1,onRowClicked:function(){}};var we=Pe;export{H as ADVANCED,Z as INFINITE_LOADING,W as LINKS,J as LOAD_MORE,$ as PAGINATION_TYPES,we as QueryList,Y as SIMPLE};
//# sourceMappingURL=index.mjs.map
