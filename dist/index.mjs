import{get as e,debounce as t,isEmpty as n,isString as r,isUndefined as a,flow as o,uniq as i,sortBy as l,filter as u,includes as c,has as s}from"lodash";import m,{useRef as d,useCallback as p,useEffect as f,useMemo as g,isValidElement as v,forwardRef as y,Fragment as h}from"react";import E from"prop-types";import{useQueryClient as P,useInfiniteQuery as w,useQuery as k}from"@tanstack/react-query";import{InView as x}from"react-intersection-observer";import{Pagination as b,Stack as L,TextField as N,MenuItem as T,Typography as q,Button as C,List as O,LinearProgress as I,Box as K,Alert as z,Divider as R}from"@mui/material";import S from"zustand-store-addons";import j from"zustand/context";import F from"zustand/shallow";import _ from"immer";import{useRafState as B,useUpdateEffect as M}from"react-use";import Q from"jquery";import U from"axios";import{usePagination as A}from"@mui/lab";import{scrollTo as D}from"scroll-js";import G from"numeral";var J,V="simple",X="advanced",Y="load-more",H="links",W="infinite-loading",Z=((J={}).simple="Simple",J.links="Links",J.advanced="Advanced",J["load-more"]="Load More",J["infinite-loading"]="Infinite Loading",J);function $(){return $=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},$.apply(this,arguments)}function ee(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t.indexOf(n=o[r])>=0||(a[n]=e[n]);return a}var te=function(){return S(function(e,t){return{pagination:"simple",queryKey:[],init:function(t){var n=[t.queryKey,{url:t.url}];console.log(n),e({queryKey:n,pagination:t.pagination,selected:!1})},selected:!1,setSelected:function(t){return e({selected:t})},setPage:function(t){return e(_(function(e){e.queryKey[1].params.page=t}))},setPerPage:function(t){return e(_(function(e){e.queryKey[1].params.perPage=t}))}}},{computed:{perPage:function(){return e(this.queryKey,"1.params.perPage")},page:function(){return e(this.queryKey,"1.params.page")}}})},ne=j(),re=ne.Provider,ae=function(e,t){return ne.useStore.apply(ne,oe(e,t))},oe=function(e,t){if("string"==typeof e){if(-1!==e.indexOf(",")){var n=e.split(",").map(function(e){return e.trim()});return[function(e){return n.map(function(t){return e[t]})},F]}return[function(t){return t[e]},t]}return[e,t]},ie=function(e){var t=P(),r=ae("queryKey, init"),a=r[0],o=r[1];f(function(){!n(a)&&t.cancelQueries(a),o(e)},[JSON.stringify(e.queryKey),e.url,e.page,e.perPage])},le=["url","params"],ue=function(e){var t=e.pageParam,n=e.queryKey,o=e.signal;try{var i=n[1],l=i.url,u=i.params,c=(ee(i,le),r(l)?$({method:"get",url:l},u):$({params:$({},u,null==l?void 0:l.params)},l));return a(t)||(c.params.page=t),Promise.resolve(U($({signal:o},c))).then(function(e){return e.data})}catch(e){return Promise.reject(e)}};function ce(e){var t=e.meta,n=ae("setPage");/*#__PURE__*/return m.createElement(b,{variant:"outlined",showFirstButton:!0,showLastButton:!0,onChange:function(e,t){return n(t)},count:null==t?void 0:t.last_page,page:null==t?void 0:t.current_page})}function se(e){var t=e.meta,n=e.sizes,r=e.size,a=ae("perPage, setPerPage, setPage"),u=a[0],c=a[1],s=a[2],d=null==t?void 0:t.last_page,p=null==t?void 0:t.current_page,f=function(e){var t=parseInt(e.target.value);("Enter"===e.key||"blur"===e.type)&&t>0&&t!==p&&(t<=d?s(t):alert("Not found page "+t))},v=g(function(){return o([i,l])(n.concat(r))},[n,r]);return console.log(v),/*#__PURE__*/m.createElement(L,{direction:"row",spacing:2,alignItems:"center",justifyContent:"center"},/*#__PURE__*/m.createElement(b,{variant:"outlined",showFirstButton:!0,showLastButton:!0,shape:"rounded",onChange:function(e,t){return s(t)},count:d,page:p}),/*#__PURE__*/m.createElement(N,{select:!0,label:"Size",value:u,onChange:function(e){return c(parseInt(e.target.value))},size:"small",style:{width:110}},v.map(function(e,t){/*#__PURE__*/return m.createElement(T,{key:t,value:e,defaultValue:!0},e," / page")})),/*#__PURE__*/m.createElement(q,null,"Go to"),/*#__PURE__*/m.createElement(N,{label:"Page",variant:"outlined",onKeyUp:f,onBlur:f,size:"small",type:"number",style:{width:85}}))}se.defaultProps={sizes:[10,20,50,100,200]};var me,de=["page","type","selected"];function pe(t){var n,r=ae("pagination"),a="function"==typeof(n=r)&&v(n())?r:e(pe.types,r,ce);/*#__PURE__*/return m.createElement(a,t)}pe.propTypes={type:E.oneOfType([E.string,E.func])},pe.types=((me={}).simple=ce,me.links=function(e){var t=e.meta,n=ae("setPage"),r=A({count:null==t?void 0:t.last_page,onChange:function(e,t){return n(t)}}),a=u(r.items,function(e){return c(["previous","next"],e.type)});/*#__PURE__*/return m.createElement("nav",null,/*#__PURE__*/m.createElement(O,null,a.map(function(e,t){var n=e.type,r=ee(e,de);/*#__PURE__*/return m.createElement(C,$({type:"button"},r,{key:t}),n)})))},me.advanced=se,me["load-more"]=function(e){var t=e.queryInfo||{},n=t.isFetchingNextPage,r=t.fetchNextPage,a=t.hasNextPage;return a?/*#__PURE__*/m.createElement(C,{variant:"outlined",onClick:function(){return r()},disabled:!a||n},n?"Loading more...":"Load More"):"Nothing more to load"},me["infinite-loading"]=function(e){var t=e.threshold,n=e.queryInfo||{},r=n.isFetchingNextPage,a=n.fetchNextPage,o=n.hasNextPage;return o?r?/*#__PURE__*/m.createElement(I,{className:"w-full mt-12",color:"secondary"}):t?null:/*#__PURE__*/m.createElement(L,{alignItems:"center"},/*#__PURE__*/m.createElement(x,{as:C,onClick:function(){return a()},disabled:!o||r,onChange:function(e){return e&&o&&a()}},"Load More")):"Nothing more to load"},me);var fe=y(function(t,n){var r,a,o=t.renderListItem,i=t.renderList,l=t.wrapperListItem,u=t.onRowClicked,c=ae("queryKey, selected, setSelected"),d=c[1],p=c[2],v=w(c[0],ue,{getPreviousPageParam:function(e,t){var n=e.meta.current_page-1;return n>0?n:void 0},getNextPageParam:function(e,t){var n=e.meta.current_page+1;return n<=e.meta.last_page?n:void 0}}),y=v.status,E=v.data,P=v.error,k=v.isFetching,b=v.isFetchingNextPage,N=v.isFetchingPreviousPage,T=v.fetchNextPage,q=v.fetchPreviousPage,O=v.hasNextPage,z=v.hasPreviousPage;ie(t);var R=g(function(){return e(E,"pages.0.data.0")},[e(E,"pages.0.data.0")]);return f(function(){},[]),/*#__PURE__*/m.createElement("div",null,"loading"===y?/*#__PURE__*/m.createElement(I,{className:"w-full",color:"primary"}):"error"===y?/*#__PURE__*/m.createElement("span",null,"Error: ",P.message):/*#__PURE__*/m.createElement(h,null,t.page>1&&/*#__PURE__*/m.createElement(C,{className:"mb-6",onClick:function(){return q()},disabled:!z||N},N?"Loading more...":z?"Load Older":"Nothing more to load"),/*#__PURE__*/m.createElement(i,{meta:null==E?void 0:E.meta,firstRow:R,aaa:123},null==(r=E.pages)?void 0:r.map(function(e,n){/*#__PURE__*/return m.createElement(h,{key:n},e.data.map(function(r,a){var i=a+e.meta.from,c={serial:i,data:r,meta:e.meta,onRowClicked:function(e,t){var n=d!==i&&i;p(n),u(e,{item:t,selected:n})},selected:i===d,setSelected:p};return l?/*#__PURE__*/m.createElement(K,{key:a,component:"infinite-loading"===t.pagination&&t.threshold&&t.threshold>0&&t.threshold<=e.data.length&&e.data.length-t.threshold===a+1?x:K,onChange:function(e,t){return function(e,t,n){e&&O&&!s(E,["pages",n+1])&&T()}(e,0,n)}},/*#__PURE__*/m.createElement(o,c)):/*#__PURE__*/m.createElement(o,$({key:a},c))}))})),t.backToTop&&(null==(a=t.scrollPosition)?void 0:a.y)>400&&/*#__PURE__*/m.createElement(C,{onClick:function(){D(document.querySelector(t.scrollTarget)||window,{top:0,duration:200})},className:"fixed",sx:{bottom:90,right:100,zIndex:100},variant:"outlined"},/*#__PURE__*/m.createElement("i",{className:"fa-solid fa-arrow-up-to-line mr-10"}),"Back to top"),/*#__PURE__*/m.createElement(L,{direction:"row",justifyContent:"center"},/*#__PURE__*/m.createElement(pe,{queryInfo:v,data:E,threshold:t.threshold})),k&&!b?/*#__PURE__*/m.createElement(L,{className:"mt-6",alignItems:"center",spacing:1},/*#__PURE__*/m.createElement("p",{className:"font-semibold"},"Background Updating..."),/*#__PURE__*/m.createElement(I,{className:"w-full",color:"primary"})):null))});fe.defaultProps={wrapperListItem:!0};var ge=fe;function ve(t){var n,r=t.renderListItem,a=t.renderList,o=t.onRowClicked,i=ae("queryKey, selected, setSelected"),l=i[1],u=i[2],c=k(i[0],ue,{keepPreviousData:!0,staleTime:5e3}),s=c.isLoading,d=c.isSuccess,p=c.isFetching,f=c.error,v=c.data;ie(t),M(function(){Q(t.scrollTarget||window).scrollTop(0)},[v]);var y=g(function(){return e(v,"data.0")},[e(v,"data.0")]);/*#__PURE__*/return m.createElement(L,{spacing:1.5},s&&/*#__PURE__*/m.createElement(I,null),(null==f?void 0:f.message)&&/*#__PURE__*/m.createElement(z,{variant:"filled",severity:"error"},null==f?void 0:f.message),d&&/*#__PURE__*/m.createElement(h,null,/*#__PURE__*/m.createElement(a,{meta:null==v?void 0:v.meta,firstRow:y},null==v||null==(n=v.data)?void 0:n.map(function(e,t){var n=v.meta.from+t;/*#__PURE__*/return m.createElement(r,{key:t,serial:v.meta.from+t,data:e,meta:null==v?void 0:v.meta,onRowClicked:function(t,r){var a=l!==n&&n;u(a),o(t,{item:e,selected:a})}})})),p&&/*#__PURE__*/m.createElement(I,null)),(null==v?void 0:v.meta)&&/*#__PURE__*/m.createElement(pe,{meta:v.meta,size:t.perPage,sizes:t.sizes}))}function ye(e,t){return void 0===t&&(t="0,0"),G(e).format(t)}var he=["children","meta"],Ee=y(function(e,n){var r=function(e){var n=e.scrollTarget,r=e.scrollIndex,a=e.wait,o=void 0===a?300:a,i=d(),l=B({x:0,y:0}),u=l[0],c=l[1],s=p(function(e){var t=n?{x:"scrollLeft",y:"scrollTop"}:{x:"pageXOffset",y:"pageYOffset"};c({x:i.current[t.x],y:i.current[t.y]})},[n]);return f(function(){return i.current=n?document.querySelector(n):window,i.current.addEventListener("scroll",t(s,o)),function(){i.current.removeEventListener("scroll",s)}},[]),f(function(){setTimeout(function(){scrollTo(Q(n).get(0))},1e3)},[r]),u}(e),a=$({},e,{scrollPosition:r});/*#__PURE__*/return m.createElement(re,{createStore:te},c(["load-more","infinite-loading"],e.pagination)?/*#__PURE__*/m.createElement(ge,$({ref:n},a)):/*#__PURE__*/m.createElement(ve,$({ref:n},a)))});Ee.propTypes={queryKey:E.oneOfType([E.string,E.array]),url:E.oneOfType([E.string,E.object]),pagination:E.oneOfType([E.string,E.func]),page:E.oneOfType([E.string,E.number]),perPage:E.oneOfType([E.string,E.number]),select:E.func,threshold:E.number,scrollTop:E.bool,scrollTarget:E.string},Ee.defaultProps={pagination:"simple",page:1,perPage:10,renderListItem:function(e){/*#__PURE__*/return React.createElement("div",null,e.serial,") ",e.data.id)},renderList:function(e){var t=e.children,n=e.meta;return ee(e,he),/*#__PURE__*/React.createElement(L,{spacing:1},/*#__PURE__*/React.createElement("div",null,"Kết quả từ ",ye(n.from),"-",ye(n.to)," trong số"," ",ye(n.total)),/*#__PURE__*/React.createElement(L,{spacing:2,divider:/*#__PURE__*/React.createElement(R,{orientation:"horizontal"}),sx:{py:2}},t))},backToTop:!1,onRowClicked:function(){}};var Pe=Ee;export{X as ADVANCED,W as INFINITE_LOADING,H as LINKS,Y as LOAD_MORE,Z as PAGINATION_TYPES,Pe as QueryList,V as SIMPLE};
//# sourceMappingURL=index.mjs.map
