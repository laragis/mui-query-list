import{get as e,debounce as t,isEmpty as n,isString as r,isUndefined as a,flow as o,uniq as i,sortBy as l,filter as u,includes as c,has as s}from"lodash";import m,{useRef as p,useCallback as g,useEffect as d,useMemo as f,isValidElement as y,Fragment as v}from"react";import h from"prop-types";import{useQueryClient as P,useInfiniteQuery as E,useQuery as x}from"@tanstack/react-query";import{InView as b}from"react-intersection-observer";import{Pagination as T,Stack as k,TextField as q,MenuItem as L,Typography as N,Button as w,List as R,LinearProgress as K,Box as O,Alert as z,Divider as I}from"@mui/material";import C from"zustand-store-addons";import j from"zustand/context";import F from"zustand/shallow";import _ from"immer";import{useRafState as B,useUpdateEffect as S}from"react-use";import M from"jquery";import U from"axios";import{usePagination as A}from"@mui/lab";import{scrollTo as D}from"scroll-js";import G from"numeral";var Q,V="simple",X="advanced",Y="load-more",H="links",J="infinite-loading",W=((Q={}).simple="Simple",Q.links="Links",Q.advanced="Advanced",Q["load-more"]="Load More",Q["infinite-loading"]="Infinite Loading",Q);function Z(){return Z=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Z.apply(this,arguments)}function $(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t.indexOf(n=o[r])>=0||(a[n]=e[n]);return a}var ee={pagination:"simple",queryKey:[]},te=function(){return C(function(e,t){return Z({},ee,{init:function(t){e({queryKey:[t.queryKey,{url:t.url,pagination:t.pagination,params:{page:t.page>0?t.page:1,perPage:t.perPage>0?t.perPage:20}}],pagination:t.pagination})},setPage:function(t){return e(_(function(e){e.queryKey[1].params.page=t}))},setPerPage:function(t){return e(_(function(e){e.queryKey[1].params.perPage=t}))}})},{computed:{perPage:function(){return e(this.queryKey,"1.params.perPage")},page:function(){return e(this.queryKey,"1.params.page")}}})},ne=j(),re=ne.Provider,ae=function(e,t){return ne.useStore.apply(ne,oe(e,t))},oe=function(e,t){if("string"==typeof e){if(-1!==e.indexOf(",")){var n=e.split(",").map(function(e){return e.trim()});return[function(e){return n.map(function(t){return e[t]})},F]}return[function(t){return t[e]},t]}return[e,t]},ie=function(e){var t=P(),r=ae("queryKey, init"),a=r[0],o=r[1];d(function(){!n(a)&&t.cancelQueries(a),o(e)},[e.queryKey,e.url,e.page,e.perPage])},le=["url","params"],ue=function(e){var t=e.pageParam,n=e.queryKey,o=e.signal;try{var i=n[1],l=i.url,u=i.params,c=($(i,le),r(l)?Z({method:"get"},u):Z({params:Z({},u,null==l?void 0:l.params)},l));return a(t)||(c.params.page=t),Promise.resolve(U(Z({signal:o},c))).then(function(e){return e.data})}catch(e){return Promise.reject(e)}};function ce(e){var t=e.meta,n=ae("setPage");/*#__PURE__*/return React.createElement(T,{variant:"outlined",showFirstButton:!0,showLastButton:!0,onChange:function(e,t){return n(t)},count:null==t?void 0:t.last_page,page:null==t?void 0:t.current_page})}function se(e){var t=e.meta,n=e.sizes,r=e.size,a=ae("perPage, setPerPage, setPage"),u=a[0],c=a[1],s=a[2],p=null==t?void 0:t.last_page,g=null==t?void 0:t.current_page,d=function(e){var t=parseInt(e.target.value);("Enter"===e.key||"blur"===e.type)&&t>0&&t!==g&&(t<=p?s(t):alert("Not found page "+t))},y=f(function(){return o([i,l])(n.concat(r))},[n,r]);return console.log(y),/*#__PURE__*/m.createElement(k,{direction:"row",spacing:2,alignItems:"center",justifyContent:"center"},/*#__PURE__*/m.createElement(T,{variant:"outlined",showFirstButton:!0,showLastButton:!0,shape:"rounded",onChange:function(e,t){return s(t)},count:p,page:g}),/*#__PURE__*/m.createElement(q,{select:!0,label:"Size",value:u,onChange:function(e){return c(parseInt(e.target.value))},size:"small",style:{width:110}},y.map(function(e,t){/*#__PURE__*/return m.createElement(L,{key:t,value:e,defaultValue:!0},e," / page")})),/*#__PURE__*/m.createElement(N,null,"Go to"),/*#__PURE__*/m.createElement(q,{label:"Page",variant:"outlined",onKeyUp:d,onBlur:d,size:"small",type:"number",style:{width:85}}))}se.defaultProps={sizes:[10,20,50,100,200]};var me,pe=["page","type","selected"];function ge(t){var n,r=ae("pagination"),a="function"==typeof(n=r)&&y(n())?r:e(ge.types,r,ce);/*#__PURE__*/return m.createElement(a,t)}function de(e){var t,n,r=e.renderListItem,a=e.renderList,o=ae("queryKey"),i=E(o,ue,{getPreviousPageParam:function(e,t){var n=e.meta.current_page-1;return n>0?n:void 0},getNextPageParam:function(e,t){var n=e.meta.current_page+1;return n<=e.meta.last_page?n:void 0}}),l=i.status,u=i.data,c=i.error,p=i.isFetching,g=i.isFetchingNextPage,d=i.isFetchingPreviousPage,f=i.fetchNextPage,y=i.fetchPreviousPage,h=i.hasNextPage,P=i.hasPreviousPage;return ie(e),/*#__PURE__*/m.createElement("div",null,"loading"===l?/*#__PURE__*/m.createElement("p",null,"Loading..."):"error"===l?/*#__PURE__*/m.createElement("span",null,"Error: ",c.message):/*#__PURE__*/m.createElement(v,null,e.page>1&&/*#__PURE__*/m.createElement(w,{className:"mb-6",onClick:function(){return y()},disabled:!P||d},d?"Loading more...":P?"Load Older":"Nothing more to load"),null==(t=u.pages)?void 0:t.map(function(t,n){/*#__PURE__*/return m.createElement(v,{key:n},t.data.map(function(o,i){var l=a;return"infinite-loading"===e.pagination&&e.threshold&&e.threshold>0&&e.threshold<=t.data.length&&t.data.length-e.threshold===i+1&&(l=b),/*#__PURE__*/m.createElement(O,{key:i,component:l,onChange:function(e,t){return function(e,t,n){e&&h&&!s(u,["pages",n+1])&&f()}(e,0,n)}},/*#__PURE__*/m.createElement(r,{serial:i+t.meta.from,data:o,meta:t.meta}))}))}),e.backToTop&&(null==(n=e.scrollPosition)?void 0:n.y)>400&&/*#__PURE__*/m.createElement(w,{onClick:function(){D(document.querySelector(e.scrollTarget)||window,{top:0,duration:200})},className:"fixed",sx:{bottom:90,right:100,zIndex:100},variant:"outlined"},/*#__PURE__*/m.createElement("i",{className:"fa-solid fa-arrow-up-to-line mr-10"}),"Back to top"),/*#__PURE__*/m.createElement(k,{direction:"row",justifyContent:"center"},/*#__PURE__*/m.createElement(ge,{queryInfo:i,data:u,threshold:e.threshold})),p&&!g?/*#__PURE__*/m.createElement(k,{className:"mt-6",alignItems:"center",spacing:1},/*#__PURE__*/m.createElement("p",{className:"font-semibold"},"Background Updating..."),/*#__PURE__*/m.createElement(K,{className:"w-full",color:"secondary"})):null))}function fe(e){var t,n=e.renderListItem,r=e.renderList,a=ae("queryKey"),o=x(a,ue,{keepPreviousData:!0,staleTime:5e3}),i=o.isLoading,l=o.isSuccess,u=o.isFetching,c=o.error,s=o.data;return ie(e),S(function(){M(e.scrollTarget||window).scrollTop(0)},[s]),/*#__PURE__*/React.createElement(k,{spacing:1.5},i&&/*#__PURE__*/React.createElement(K,null),(null==c?void 0:c.message)&&/*#__PURE__*/React.createElement(z,{variant:"filled",severity:"error"},null==c?void 0:c.message),l&&/*#__PURE__*/React.createElement(Fragment,null,/*#__PURE__*/React.createElement(r,{meta:null==s?void 0:s.meta},null==s||null==(t=s.data)?void 0:t.map(function(e,t){/*#__PURE__*/return React.createElement(n,{key:t,serial:s.meta.from+t,data:e,meta:null==s?void 0:s.meta})})),u&&/*#__PURE__*/React.createElement(K,null)),(null==s?void 0:s.meta)&&/*#__PURE__*/React.createElement(ge,{meta:s.meta,size:e.perPage,sizes:e.sizes}))}function ye(e,t){return void 0===t&&(t="0,0"),G(e).format(t)}ge.propTypes={type:h.oneOfType([h.string,h.func])},ge.types=((me={}).simple=ce,me.links=function(e){var t=e.meta,n=ae("setPage"),r=A({count:null==t?void 0:t.last_page,onChange:function(e,t){return n(t)}}),a=u(r.items,function(e){return c(["previous","next"],e.type)});/*#__PURE__*/return React.createElement("nav",null,/*#__PURE__*/React.createElement(R,null,a.map(function(e,t){var n=e.type,r=$(e,pe);/*#__PURE__*/return React.createElement(w,Z({type:"button"},r,{key:t}),n)})))},me.advanced=se,me["load-more"]=function(e){var t=e.queryInfo||{},n=t.isFetchingNextPage,r=t.fetchNextPage,a=t.hasNextPage;return a?/*#__PURE__*/React.createElement(w,{variant:"outlined",onClick:function(){return r()},disabled:!a||n},n?"Loading more...":"Load More"):"Nothing more to load"},me["infinite-loading"]=function(e){var t=e.threshold,n=e.queryInfo||{},r=n.isFetchingNextPage,a=n.fetchNextPage,o=n.hasNextPage;return o?r?/*#__PURE__*/m.createElement(K,{className:"w-full mt-12",color:"secondary"}):t?null:/*#__PURE__*/m.createElement(k,{alignItems:"center"},/*#__PURE__*/m.createElement(b,{as:w,onClick:function(){return a()},disabled:!o||r,onChange:function(e){return e&&o&&a()}},"Load More")):"Nothing more to load"},me);var ve=["children","meta"];function he(e){var n,r,a,o,i,l,u,s,f,y,v=(r=(n=e).scrollTarget,a=n.scrollIndex,i=void 0===(o=n.wait)?300:o,l=p(),s=(u=B({x:0,y:0}))[0],f=u[1],y=g(function(e){var t=r?{x:"scrollLeft",y:"scrollTop"}:{x:"pageXOffset",y:"pageYOffset"};f({x:l.current[t.x],y:l.current[t.y]})},[r]),d(function(){return l.current=r?document.querySelector(r):window,l.current.addEventListener("scroll",t(y,i)),function(){l.current.removeEventListener("scroll",y)}},[]),d(function(){setTimeout(function(){console.log(r),scrollTo(M(r).get(0))},1e3)},[a]),s);/*#__PURE__*/return m.createElement(re,{createStore:te},c(["load-more","infinite-loading"],e.pagination)?/*#__PURE__*/m.createElement(de,Z({},e,{scrollPosition:v})):/*#__PURE__*/m.createElement(fe,Z({},e,{scrollPosition:v})))}he.propTypes={queryKey:h.string,url:h.oneOfType([h.string,h.object]),pagination:h.oneOfType([h.string,h.func]),page:h.oneOfType([h.string,h.number]),perPage:h.oneOfType([h.string,h.number]),select:h.func,threshold:h.number,scrollTop:h.bool,scrollTarget:h.string},he.defaultProps={pagination:"simple",page:1,perPage:10,renderListItem:function(e){/*#__PURE__*/return React.createElement("div",null,e.serial,") ",e.data.id)},renderList:function(e){var t=e.children,n=e.meta;return $(e,ve),/*#__PURE__*/React.createElement(k,{spacing:1},/*#__PURE__*/React.createElement("div",null,"Kết quả từ ",ye(n.from),"-",ye(n.to)," trong số"," ",ye(n.total)),/*#__PURE__*/React.createElement(k,{spacing:2,divider:/*#__PURE__*/React.createElement(I,{orientation:"horizontal"}),sx:{py:2}},t))},backToTop:!1};export{X as ADVANCED,J as INFINITE_LOADING,H as LINKS,Y as LOAD_MORE,W as PAGINATION_TYPES,he as QueryList,V as SIMPLE};
//# sourceMappingURL=index.mjs.map
