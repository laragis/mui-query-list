import{castArray as e,get as t,debounce as r,isEmpty as n,isString as a,isUndefined as o,flow as i,uniq as l,sortBy as u,filter as c,includes as s,last as m,has as p}from"lodash";import d,{useRef as f,useCallback as g,useEffect as v,useMemo as y,isValidElement as h,forwardRef as E,Fragment as P}from"react";import w from"prop-types";import{useQueryClient as k,useInfiniteQuery as x,useQuery as b}from"@tanstack/react-query";import{InView as L}from"react-intersection-observer";import{Pagination as T,Stack as q,TextField as N,MenuItem as C,Typography as O,Button as I,List as K,LinearProgress as z,Box as R,Alert as S,Divider as j}from"@mui/material";import F from"zustand-store-addons";import _ from"zustand/context";import B from"zustand/shallow";import M from"immer";import{useRafState as Q,useUpdateEffect as U}from"react-use";import A from"jquery";import D from"axios";import{usePagination as G}from"@mui/lab";import{scrollTo as J}from"scroll-js";import V from"numeral";var X,Y="simple",H="advanced",W="load-more",Z="links",$="infinite-loading",ee=((X={}).simple="Simple",X.links="Links",X.advanced="Advanced",X["load-more"]="Load More",X["infinite-loading"]="Infinite Loading",X);function te(){return te=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},te.apply(this,arguments)}function re(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)t.indexOf(r=o[n])>=0||(a[r]=e[r]);return a}var ne=function(){return F(function(t,r){return{pagination:"simple",queryKey:[],init:function(r){var n=[e(r.queryKey)[0],{url:r.url,pagination:r.pagination,params:te({},e(r.queryKey)[1],{page:r.page>0?r.page:1,perPage:r.perPage>0?r.perPage:20})}];t({queryKey:n,pagination:r.pagination,selected:!1})},selected:!1,setSelected:function(e){return t({selected:e})},setPage:function(e){return t(M(function(t){t.queryKey[1].params.page=e}))},setPerPage:function(e){return t(M(function(t){t.queryKey[1].params.perPage=e}))}}},{computed:{perPage:function(){return t(this.queryKey,"1.params.perPage")},page:function(){return t(this.queryKey,"1.params.page")}}})},ae=_(),oe=ae.Provider,ie=function(e,t){return ae.useStore.apply(ae,le(e,t))},le=function(e,t){if("string"==typeof e){if(-1!==e.indexOf(",")){var r=e.split(",").map(function(e){return e.trim()});return[function(e){return r.map(function(t){return e[t]})},B]}return[function(t){return t[e]},t]}return[e,t]},ue=function(e){var t=k(),r=ie("queryKey, init"),a=r[0],o=r[1];v(function(){!n(a)&&t.cancelQueries(a),o(e)},[JSON.stringify(e.queryKey),e.url,e.page,e.perPage])},ce=["url","params"],se=function(e){var t=e.pageParam,r=e.queryKey,n=e.signal;try{var i=r[1],l=i.url,u=i.params,c=(re(i,ce),a(l)?{method:"get",url:l,params:u}:te({params:te({},u,null==l?void 0:l.params)},l));return o(t)||(c.params.page=t),Promise.resolve(D(te({signal:n},c))).then(function(e){return e.data})}catch(e){return Promise.reject(e)}};function me(e){var t=e.meta,r=ie("setPage");/*#__PURE__*/return d.createElement(T,{variant:"outlined",showFirstButton:!0,showLastButton:!0,onChange:function(e,t){return r(t)},count:null==t?void 0:t.last_page,page:null==t?void 0:t.current_page})}function pe(e){var t=e.meta,r=e.sizes,n=e.size,a=ie("perPage, setPerPage, setPage"),o=a[0],c=a[1],s=a[2],m=null==t?void 0:t.last_page,p=null==t?void 0:t.current_page,f=function(e){var t=parseInt(e.target.value);("Enter"===e.key||"blur"===e.type)&&t>0&&t!==p&&(t<=m?s(t):alert("Not found page "+t))},g=y(function(){return i([l,u])(r.concat(n))},[r,n]);return console.log(g),/*#__PURE__*/d.createElement(q,{direction:"row",spacing:2,alignItems:"center",justifyContent:"center"},/*#__PURE__*/d.createElement(T,{variant:"outlined",showFirstButton:!0,showLastButton:!0,shape:"rounded",onChange:function(e,t){return s(t)},count:m,page:p}),/*#__PURE__*/d.createElement(N,{select:!0,label:"Size",value:o,onChange:function(e){return c(parseInt(e.target.value))},size:"small",style:{width:110}},g.map(function(e,t){/*#__PURE__*/return d.createElement(C,{key:t,value:e,defaultValue:!0},e," / page")})),/*#__PURE__*/d.createElement(O,null,"Go to"),/*#__PURE__*/d.createElement(N,{label:"Page",variant:"outlined",onKeyUp:f,onBlur:f,size:"small",type:"number",style:{width:85}}))}pe.defaultProps={sizes:[10,20,50,100,200]};var de,fe=["page","type","selected"];function ge(e){var r,n=ie("pagination"),a="function"==typeof(r=n)&&h(r())?n:t(ge.types,n,me);/*#__PURE__*/return d.createElement(a,e)}ge.propTypes={type:w.oneOfType([w.string,w.func])},ge.types=((de={}).simple=me,de.links=function(e){var t=e.meta,r=ie("setPage"),n=G({count:null==t?void 0:t.last_page,onChange:function(e,t){return r(t)}}),a=c(n.items,function(e){return s(["previous","next"],e.type)});/*#__PURE__*/return d.createElement("nav",null,/*#__PURE__*/d.createElement(K,null,a.map(function(e,t){var r=e.type,n=re(e,fe);/*#__PURE__*/return d.createElement(I,te({type:"button"},n,{key:t}),r)})))},de.advanced=pe,de["load-more"]=function(e){var t=e.queryInfo||{},r=t.isFetchingNextPage,n=t.fetchNextPage,a=t.hasNextPage;return a?/*#__PURE__*/d.createElement(I,{variant:"outlined",onClick:function(){return n()},disabled:!a||r},r?"Loading more...":"Load More"):"Nothing more to load"},de["infinite-loading"]=function(e){var t=e.threshold,r=e.queryInfo||{},n=r.isFetchingNextPage,a=r.fetchNextPage,o=r.hasNextPage;return o?n?/*#__PURE__*/d.createElement(z,{className:"w-full mt-12",color:"secondary"}):t?null:/*#__PURE__*/d.createElement(q,{alignItems:"center"},/*#__PURE__*/d.createElement(L,{as:I,onClick:function(){return a()},disabled:!o||n,onChange:function(e){return e&&o&&a()}},"Load More")):""},de);var ve=E(function(e,r){var n,a,o=e.renderListItem,i=e.renderList,l=e.wrapperListItem,u=e.onRowClicked,c=ie("queryKey, selected, setSelected"),s=c[1],f=c[2],g=x(c[0],se,{getPreviousPageParam:function(e,t){var r=e.meta.current_page-1;return r>0?r:void 0},getNextPageParam:function(e,t){var r=e.meta.current_page+1;return r<=e.meta.last_page?r:void 0}}),v=g.status,h=g.data,E=g.error,w=g.isFetching,k=g.isFetchingNextPage,b=g.isFetchingPreviousPage,T=g.fetchNextPage,N=g.fetchPreviousPage,C=g.hasNextPage,O=g.hasPreviousPage;ue(e);var K=y(function(){return t(h,"pages.0.data.0")},[t(h,"pages.0.data.0")]),S=m((null==h?void 0:h.pages)||[]),j=y(function(){return te({},t(S,"meta"))},[S]);/*#__PURE__*/return d.createElement("div",null,"loading"===v?/*#__PURE__*/d.createElement(z,{className:"w-full",color:"primary"}):"error"===v?/*#__PURE__*/d.createElement("span",null,"Error: ",E.message):/*#__PURE__*/d.createElement(P,null,e.page>1&&/*#__PURE__*/d.createElement(I,{className:"mb-6",onClick:function(){return N()},disabled:!O||b},b?"Loading more...":O?"Load Older":"Nothing more to load"),/*#__PURE__*/d.createElement(i,{meta:j,firstRow:K},null==(n=h.pages)?void 0:n.map(function(t,r){/*#__PURE__*/return d.createElement(P,{key:r},t.data.map(function(n,a){var i=a+t.meta.from,c={serial:i,data:n,meta:t.meta,onRowClicked:function(e,t){var r=s!==i&&i;f(r),u(e,{item:t,selected:r})},selected:i===s,setSelected:f};return l?/*#__PURE__*/d.createElement(R,{key:a,component:"infinite-loading"===e.pagination&&e.threshold&&e.threshold>0&&e.threshold<=t.data.length&&t.data.length-e.threshold===a+1?L:R,onChange:function(e,t){return function(e,t,r){e&&C&&!p(h,["pages",r+1])&&T()}(e,0,r)}},/*#__PURE__*/d.createElement(o,c)):/*#__PURE__*/d.createElement(o,te({key:a},c))}))})),e.backToTop&&(null==(a=e.scrollPosition)?void 0:a.y)>400&&/*#__PURE__*/d.createElement(I,{onClick:function(){J(document.querySelector(e.scrollTarget)||window,{top:0,duration:200})},className:"fixed",sx:{bottom:90,right:100,zIndex:100},variant:"outlined"},/*#__PURE__*/d.createElement("i",{className:"fa-solid fa-arrow-up-to-line mr-10"}),"Back to top"),/*#__PURE__*/d.createElement(q,{direction:"row",justifyContent:"center"},/*#__PURE__*/d.createElement(ge,{queryInfo:g,data:h,threshold:e.threshold})),w&&!k?/*#__PURE__*/d.createElement(q,{className:"mt-6",alignItems:"center",spacing:1},/*#__PURE__*/d.createElement("p",{className:"font-semibold"},"Background Updating..."),/*#__PURE__*/d.createElement(z,{className:"w-full",color:"primary"})):null))});ve.defaultProps={wrapperListItem:!0};var ye=ve;function he(e){var r,n=e.renderListItem,a=e.renderList,o=e.onRowClicked,i=ie("queryKey, selected, setSelected"),l=i[1],u=i[2],c=b(i[0],se,{keepPreviousData:!0,staleTime:5e3}),s=c.isLoading,m=c.isSuccess,p=c.isFetching,f=c.error,g=c.data;ue(e),U(function(){A(e.scrollTarget||window).scrollTop(0)},[g]);var v=y(function(){return t(g,"data.0")},[t(g,"data.0")]);/*#__PURE__*/return d.createElement(q,{spacing:1.5},s&&/*#__PURE__*/d.createElement(z,null),(null==f?void 0:f.message)&&/*#__PURE__*/d.createElement(S,{variant:"filled",severity:"error"},null==f?void 0:f.message),m&&/*#__PURE__*/d.createElement(P,null,/*#__PURE__*/d.createElement(a,{meta:null==g?void 0:g.meta,firstRow:v},null==g||null==(r=g.data)?void 0:r.map(function(e,t){var r=g.meta.from+t;/*#__PURE__*/return d.createElement(n,{key:t,serial:g.meta.from+t,data:e,meta:null==g?void 0:g.meta,onRowClicked:function(t,n){var a=l!==r&&r;u(a),o(t,{item:e,selected:a})}})})),p&&/*#__PURE__*/d.createElement(z,null)),(null==g?void 0:g.meta)&&/*#__PURE__*/d.createElement(ge,{meta:g.meta,size:e.perPage,sizes:e.sizes}))}function Ee(e,t){return void 0===t&&(t="0,0"),V(e).format(t)}var Pe=["children","meta"],we=E(function(e,t){var n=function(e){var t=e.scrollTarget,n=e.scrollIndex,a=e.wait,o=void 0===a?300:a,i=f(),l=Q({x:0,y:0}),u=l[0],c=l[1],s=g(function(e){var r=t?{x:"scrollLeft",y:"scrollTop"}:{x:"pageXOffset",y:"pageYOffset"};c({x:i.current[r.x],y:i.current[r.y]})},[t]);return v(function(){return i.current=t?document.querySelector(t):window,i.current.addEventListener("scroll",r(s,o)),function(){i.current.removeEventListener("scroll",s)}},[]),v(function(){setTimeout(function(){scrollTo(A(t).get(0))},1e3)},[n]),u}(e),a=te({},e,{scrollPosition:n});/*#__PURE__*/return d.createElement(oe,{createStore:ne},s(["load-more","infinite-loading"],e.pagination)?/*#__PURE__*/d.createElement(ye,te({ref:t},a)):/*#__PURE__*/d.createElement(he,te({ref:t},a)))});we.propTypes={queryKey:w.oneOfType([w.string,w.array]),url:w.oneOfType([w.string,w.object]),pagination:w.oneOfType([w.string,w.func]),page:w.oneOfType([w.string,w.number]),perPage:w.oneOfType([w.string,w.number]),select:w.func,threshold:w.number,scrollTop:w.bool,scrollTarget:w.string},we.defaultProps={pagination:"simple",page:1,perPage:10,renderListItem:function(e){/*#__PURE__*/return React.createElement("div",null,e.serial,") ",e.data.id)},renderList:function(e){var t=e.children,r=e.meta;return re(e,Pe),/*#__PURE__*/React.createElement(q,{spacing:1},/*#__PURE__*/React.createElement("div",null,"Kết quả từ ",Ee(r.from),"-",Ee(r.to)," trong số"," ",Ee(r.total)),/*#__PURE__*/React.createElement(q,{spacing:2,divider:/*#__PURE__*/React.createElement(j,{orientation:"horizontal"}),sx:{py:2}},t))},backToTop:!1,onRowClicked:function(){}};var ke=we;export{H as ADVANCED,$ as INFINITE_LOADING,Z as LINKS,W as LOAD_MORE,ee as PAGINATION_TYPES,ke as QueryList,Y as SIMPLE};
//# sourceMappingURL=index.mjs.map
